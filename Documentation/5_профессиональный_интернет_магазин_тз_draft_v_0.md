# –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–Ω–µ—Ç‚Äë–º–∞–≥–∞–∑–∏–Ω ‚Äî –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ (v0.9)

## 0) –í–≤–µ–¥–µ–Ω–∏–µ –∏ –∏–¥–µ—è

**–¶–µ–ª—å:** —Å–æ–∑–¥–∞—Ç—å –æ–¥–∏–Ω –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π, –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–π –∏–Ω—Ç–µ—Ä–Ω–µ—Ç‚Äë–º–∞–≥–∞–∑–∏–Ω ¬´—É—Ä–æ–≤–Ω—è –ø—Ä–æ–¥–∞–∫—à–Ω¬ª, –±–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–≤ –∏ –º—É–ª—å—Ç–∏‚Äë—Ç–µ–Ω–∞–Ω—Ç–∞. –ü—Ä–æ–µ–∫—Ç —Å–ª—É–∂–∏—Ç —ç—Ç–∞–ª–æ–Ω–Ω–æ–π –±–∞–∑–æ–π, –∫–æ—Ç–æ—Ä—É—é –º–æ–∂–Ω–æ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –¥–ª—è –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–æ 300% –ø–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—É, –Ω–µ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞—è —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç.

**–ü–æ—á–µ–º—É —Ç–∞–∫:**

- 95% —Ñ—É–Ω–∫—Ü–∏–π e‚Äëcommerce —Ç–∏–ø–æ–≤—ã–µ. –ú—ã —Ä–µ–∞–ª–∏–∑—É–µ–º –∏—Ö –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ.
- –ë–∞–∑–∞ –ø—Ä–æ–µ–∫—Ç–∏—Ä—É–µ—Ç—Å—è –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ –∫ –Ω–∏—à–µ (–æ–¥–µ–∂–¥–∞/–µ–¥–∞/–∫–æ—Å–º–µ—Ç–∏–∫–∞), —á—Ç–æ–±—ã –Ω–µ –ª–æ–º–∞—Ç—å —Å—Ö–µ–º—É –ø—Ä–∏ –ø–µ—Ä–µ–Ω–æ—Å–µ.
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–µ —Ç–æ—á–∫–∏ —Ç–∞–º, –≥–¥–µ –æ—Ç–ª–∏—á–∏—è –ø–æ–≤—Ç–æ—Ä—è—é—Ç—Å—è (—Ç–µ–º–∞, —è–∑—ã–∫–∏, –≤–∞–ª—é—Ç–∞, –ø–ª–∞—Ç–µ–∂–∏, –¥–æ—Å—Ç–∞–≤–∫–∞), –≤—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ ‚Äî –≤ –∫–æ–¥–µ.

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –º–∞–≥–∞–∑–∏–Ω —Å –∫–∞—Ç–∞–ª–æ–≥–æ–º ‚Üí –ø–æ–∏—Å–∫–æ–º ‚Üí –∫–æ—Ä–∑–∏–Ω–æ–π ‚Üí checkout ‚Üí –æ–ø–ª–∞—Ç–æ–π ‚Üí –∑–∞–∫–∞–∑–∞–º–∏ ‚Üí –∞–¥–º–∏–Ω–∫–æ–π, —Å –Ω–æ—Ä–º–∞–º–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.

---

## 1) –û–±–ª–∞—Å—Ç—å —Ä–∞–±–æ—Ç (Scope MVP)

–í—Ö–æ–¥–∏—Ç:

- **–ö–∞—Ç–∞–ª–æ–≥**: –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –±—Ä–µ–Ω–¥—ã, –∞—Ç—Ä–∏–±—É—Ç—ã, –≤–∞—Ä–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç—å (–æ–ø—Ü–∏–∏ —Å–≤–æ–±–æ–¥–Ω–æ–π —Ñ–æ—Ä–º—ã), —Ñ–æ—Ç–æ/–≥–∞–ª–µ—Ä–µ—è.
- **–ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è**: –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç (Meilisearch), —Ñ–∞—Å–µ—Ç—ã, —Å–∏–Ω–æ–Ω–∏–º—ã/–æ–ø–µ—á–∞—Ç–∫–∏.
- **–ö–æ—Ä–∑–∏–Ω–∞**: –≥–æ—Å—Ç–µ–≤–∞—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–∞—è, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ, ¬´–±—Ä–æ—à–µ–Ω–Ω—ã–µ –∫–æ—Ä–∑–∏–Ω—ã¬ª (e‚Äëmail).
- **Checkout**: one‚Äëpage, –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø–æ–ª—è, –≤–∞–ª–∏–¥–∞—Ü–∏–∏, —Å–æ–≥–ª–∞—Å–∏—è.
- **–û–ø–ª–∞—Ç–∞**: Idram, ArCa (3‚ÄëDS), –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π, –≤–µ–±—Ö—É–∫–∏.
- **–î–æ—Å—Ç–∞–≤–∫–∞**: —Å–∞–º–æ–≤—ã–≤–æ–∑, –∫—É—Ä—å–µ—Ä –ø–æ –≥–æ—Ä–æ–¥—É, —Ñ–∏–∫—Å –ø–æ —Å—Ç—Ä–∞–Ω–µ; –≥–µ–æ–∑–æ–Ω—ã, free‚Äëshipping.
- **–õ–ö**: –ø—Ä–æ—Ñ–∏–ª—å, –∞–¥—Ä–µ—Å–∞, –∏—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤, –ø–æ–≤—Ç–æ—Ä –∑–∞–∫–∞–∑–∞.
- **OMS**: —Å—Ç–∞—Ç—É—Å—ã, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –º–µ–Ω–µ–¥–∂–µ—Ä–∞, e‚Äëmail/SMS —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, –¥–æ–∫—É–º–µ–Ω—Ç—ã.
- **–ö–æ–Ω—Ç–µ–Ω—Ç/SEO**: –±–ª–æ–≥/–Ω–æ–≤–æ—Å—Ç–∏, OG, Schema.org, hreflang, sitemap, robots.
- **–ê–¥–º–∏–Ω–∫–∞**: CRUD —Ç–æ–≤–∞—Ä–æ–≤/–∫–∞—Ç–µ–≥–æ—Ä–∏–π/–∞—Ç—Ä–∏–±—É—Ç–æ–≤, –º–∞—Å—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏, –∏–º–ø–æ—Ä—Ç CSV/XLSX, –∑–∞–∫–∞–∑—ã, –∫—É–ø–æ–Ω—ã.

–û—Ç–ª–æ–∂–µ–Ω–æ (–ø–æ—Å–ª–µ v1.0): —Ä–µ—Ñ–µ—Ä–∞–ª–∫–∞, B2B‚Äë–ø—Ä–∞–π—Å—ã, –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å‚Äë—Ñ–∏–¥—ã, –º—É–ª—å—Ç–∏‚Äë—Å–∫–ª–∞–¥, RMA‚Äë–∫–∞–±–∏–Ω–µ—Ç, —ç–∫—Å–ø–æ—Ä—Ç —è—Ä–ª—ã–∫–æ–≤ –∫—É—Ä—å–µ—Ä–æ–≤.

---

## 2) –ù–µ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è (SLA/SLO/–∫–∞—á–µ—Å—Ç–≤–æ)

- **SLA –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏**: 99.9%/–º–µ—Å (‚âà 43 –º–∏–Ω –ø—Ä–æ—Å—Ç–æ—è –¥–æ–ø—É—Å—Ç–∏–º–æ).
- **SLO —Å–∫–æ—Ä–æ—Å—Ç–∏**:
  - TTFB p95: ‚â§ 300 –º—Å –∏–∑ –∫—ç—à–∞ CDN, ‚â§ 600 –º—Å –±–µ–∑ –∫—ç—à–∞.
  - LCP p75 ‚â§ 2.5 c, INP p75 ‚â§ 200 –º—Å, CLS p75 ‚â§ 0.1.
  - API —á—Ç–µ–Ω–∏–µ p95 ‚â§ 500 –º—Å; –∑–∞–ø–∏—Å—å p95 ‚â§ 800 –º—Å (checkout/–æ–ø–ª–∞—Ç–∞).
  - –ü–æ–∏—Å–∫ p95 ‚â§ 250 –º—Å –Ω–∞ 10k SKU.
- **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: 5xx ‚â§ 0.1%/–Ω–µ–¥–µ–ª—è.
- **–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö**: RPO ‚â§ 24 —á, RTO ‚â§ 1 —á.
- **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ**: –±–∞–∑–æ–≤—ã–π OWASP ASVS L1/L2, –∑–∞—â–∏—Ç–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö, –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è PII –≤ –ª–æ–≥–∞—Ö.

---

## 3) –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —Å—Ç–µ–∫

**–°—Ç–∏–ª—å:** TypeScript ¬´–º–∏–∫—Ä–æ‚Äë–º–æ–Ω–æ–ª–∏—Ç¬ª —Å —á–µ—Ç–∫–∏–º–∏ –º–æ–¥—É–ª—è–º–∏.

**–§—Ä–æ–Ω—Ç–µ–Ω–¥**: Next.js 15 (App Router, SSR/ISR, i18n, WCAG 2.2 AA).\
**–ë—ç–∫–µ–Ω–¥**: NestJS (REST + –≤–µ–±—Ö—É–∫–∏), RBAC, class‚Äëvalidator, DTO.\
**–ë–î**: PostgreSQL 16 (Prisma –∏–ª–∏ Drizzle –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π/ORM).\
**–ö—ç—à/–æ—á–µ—Ä–µ–¥–∏**: Redis 7 + BullMQ (email, –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è, webhooks, –æ—Ç—á—ë—Ç—ã).\
**–ü–æ–∏—Å–∫**: Meilisearch 1.x (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è).\
**–•—Ä–∞–Ω–∏–ª–∏—â–µ –º–µ–¥–∏–∞**: S3‚Äë—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–µ (Cloudflare R2/Wasabi), —á–µ—Ä–µ–∑ CDN.\
**I18n**: RU/AM/EN, –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ URL/hreflang.

**–ü–æ—á–µ–º—É —ç—Ç–æ—Ç —Å—Ç–µ–∫:** –µ–¥–∏–Ω—ã–π —è–∑—ã–∫ (TS), –±—ã—Å—Ç—Ä—ã–π dev‚Äë—Ü–∏–∫–ª, –∑—Ä–µ–ª—ã–µ —Ç—É–ª–∑—ã, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è 1‚Äì10k SKU –∏ –¥–æ 10k –∑–∞–∫–∞–∑–æ–≤/–º–µ—Å –±–µ–∑ ¬´–º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–¥–∞¬ª. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: Laravel 11 + Blade/Livewire ‚Äî –≤–æ–∑–º–æ–∂–Ω–∞, –Ω–æ –±–∞–∑–æ–≤—ã–π –≤—ã–±–æ—Ä TS.

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (–º–æ–Ω–æ—Ä–µ–ø–æ)**

```
apps/
  web/        # –≤–∏—Ç—Ä–∏–Ω–∞ (Next.js)
  api/        # NestJS API/webhooks
packages/
  domain/     # –±–∏–∑–Ω–µ—Å‚Äë–º–æ–¥–µ–ª—å, –ø—Ä–∞–≤–∏–ª–∞, use‚Äëcases (—á–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
  ui/         # –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, –¥–∏–∑–∞–π–Ω‚Äë—Å–∏—Å—Ç–µ–º–∞, —Ç–æ–∫–µ–Ω—ã
  adapters/   # –ø–ª–∞—Ç–µ–∂–∏, –¥–æ—Å—Ç–∞–≤–∫–∞, –ø–æ–∏—Å–∫ (–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã + —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)
config/
  brand.config.json   # —Ç–µ–º–∞: —Ü–≤–µ—Ç–∞/—à—Ä–∏—Ñ—Ç—ã/—Ä–∞–¥–∏—É—Å—ã
  app.config.json     # —è–∑—ã–∫–∏, –≤–∞–ª—é—Ç–∞, –Ω–∞–ª–æ–≥–∏, —Ñ–æ—Ä–º–∞—Ç—ã –∞–¥—Ä–µ—Å–æ–≤
  payments.config.json# –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã; —Å–µ–∫—Ä–µ—Ç—ã —Ç–æ–ª—å–∫–æ –≤ .env
  shipping.config.json# –≥–µ–æ–∑–æ–Ω—ã, —Ç–∞—Ä–∏—Ñ—ã, free‚Äëshipping
  features.json       # –≤–∫–ª—é—á–∞–ª–∫–∞ –º–æ–¥—É–ª–µ–π (coupons/blog/wishlist)
scripts/              # seed, index‚Äërebuild, deploy, backup‚Äëcheck
```

### 3.1 –ü—Ä–∏–º–µ—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

**–ó–∞—á–µ–º:** –ø—Ä–∏ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ –ø–æ–¥ –Ω–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ –∫–æ–Ω—Ñ–∏–≥–∏, –Ω–µ —Ç—Ä–æ–≥–∞—è –∫–æ–¥.

#### `config/brand.config.json` ‚Äî –≤–∏–∑—É–∞–ª—å–Ω–∞—è –∏–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—å

```json
{
  "name": "MyShop",
  "domain": "myshop.am",
  "logo": {
    "light": "/assets/brand/logo-light.svg",
    "dark": "/assets/brand/logo-dark.svg",
    "favicon": "/assets/brand/favicon.ico"
  },
  "colors": {
    "primary": "#FF6B35",
    "secondary": "#004E89",
    "accent": "#F77F00",
    "success": "#06A77D",
    "warning": "#FFB627",
    "error": "#D62828",
    "text": {
      "primary": "#1A202C",
      "secondary": "#718096",
      "inverse": "#FFFFFF"
    },
    "background": {
      "primary": "#FFFFFF",
      "secondary": "#F7FAFC",
      "tertiary": "#EDF2F7"
    }
  },
  "typography": {
    "fontFamily": {
      "sans": ["Inter", "system-ui", "sans-serif"],
      "heading": ["Montserrat", "sans-serif"]
    },
    "fontSize": {
      "xs": "0.75rem",
      "sm": "0.875rem",
      "base": "1rem",
      "lg": "1.125rem",
      "xl": "1.25rem",
      "2xl": "1.5rem",
      "3xl": "1.875rem",
      "4xl": "2.25rem"
    }
  },
  "borderRadius": {
    "sm": "0.25rem",
    "md": "0.5rem",
    "lg": "0.75rem",
    "xl": "1rem",
    "full": "9999px"
  },
  "social": {
    "facebook": "https://facebook.com/myshop",
    "instagram": "https://instagram.com/myshop",
    "telegram": "https://t.me/myshop"
  }
}
```

#### `config/app.config.json` ‚Äî –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è, –≤–∞–ª—é—Ç–∞, –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞

```json
{
  "defaultLocale": "ru",
  "locales": [
    {
      "code": "ru",
      "name": "–†—É—Å—Å–∫–∏–π",
      "flag": "üá∑üá∫",
      "enabled": true,
      "default": true
    },
    {
      "code": "am",
      "name": "’Ä’°’µ’•÷Ä’•’∂",
      "flag": "üá¶üá≤",
      "enabled": true
    },
    {
      "code": "en",
      "name": "English",
      "flag": "üá¨üáß",
      "enabled": true
    }
  ],
  "currency": {
    "code": "AMD",
    "symbol": "÷è",
    "symbolPosition": "after",
    "decimalPlaces": 0,
    "thousandsSeparator": " ",
    "decimalSeparator": "."
  },
  "timezone": "Asia/Yerevan",
  "dateFormat": {
    "short": "DD.MM.YYYY",
    "long": "DD MMMM YYYY",
    "time": "HH:mm"
  },
  "contact": {
    "phone": "+374 XX XXX XXX",
    "email": "info@myshop.am",
    "address": {
      "ru": "–≥. –ï—Ä–µ–≤–∞–Ω, —É–ª. –ê–±–æ–≤—è–Ω–∞ 10",
      "am": "‘µ÷Ä÷á’°’∂, ‘±’¢’∏’æ’µ’°’∂ 10",
      "en": "Yerevan, Abovyan 10"
    }
  },
  "tax": {
    "enabled": true,
    "rate": 20,
    "included": true,
    "displayInPrices": true
  },
  "orderNumberFormat": "YYMMDDxxxxx",
  "reservationTTL": 900,
  "cartExpirationDays": 30,
  "abandonedCartThresholdHours": 2,
  "minOrderAmount": 1000,
  "freeShippingThreshold": 50000
}
```

#### `config/payments.config.json` ‚Äî –ø–ª–∞—Ç—ë–∂–Ω—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã

```json
{
  "defaultProvider": "idram",
  "providers": [
    {
      "id": "idram",
      "name": "Idram",
      "enabled": true,
      "methods": ["wallet", "card"],
      "currencies": ["AMD", "USD"],
      "logo": "/assets/payments/idram.svg",
      "testMode": false,
      "webhookUrl": "/api/v1/payments/webhook/idram",
      "config": {
        "merchantId": "${IDRAM_MERCHANT_ID}",
        "secretKey": "${IDRAM_SECRET_KEY}",
        "publicKey": "${IDRAM_PUBLIC_KEY}",
        "apiUrl": "https://banking.idram.am/api/v1"
      }
    },
    {
      "id": "arca",
      "name": "ArCa",
      "enabled": true,
      "methods": ["card"],
      "currencies": ["AMD"],
      "logo": "/assets/payments/arca.svg",
      "supports3DS": true,
      "testMode": false,
      "webhookUrl": "/api/v1/payments/webhook/arca",
      "config": {
        "merchantId": "${ARCA_MERCHANT_ID}",
        "apiKey": "${ARCA_API_KEY}",
        "apiUrl": "https://ipay.arca.am/payment/rest"
      }
    }
  ],
  "retryPolicy": {
    "maxAttempts": 3,
    "backoffMs": 1000
  },
  "webhookSignatureAlgo": "hmac-sha256"
}
```

#### `config/shipping.config.json` ‚Äî –º–µ—Ç–æ–¥—ã –¥–æ—Å—Ç–∞–≤–∫–∏ –∏ –≥–µ–æ–∑–æ–Ω—ã

```json
{
  "defaultMethod": "courier_yerevan",
  "methods": [
    {
      "id": "pickup",
      "name": {
        "ru": "–°–∞–º–æ–≤—ã–≤–æ–∑",
        "am": "‘ª’∂÷Ñ’∂’∏÷Ç÷Ä’∏÷Ç’µ’∂", 
        "en": "Pickup"
      },
      "enabled": true,
      "price": 0,
      "estimatedDays": 0,
      "icon": "store",
      "locations": [
        {
          "name": { "ru": "–ì–ª–∞–≤–Ω—ã–π –æ—Ñ–∏—Å", "am": "‘≥’¨’≠’°’æ’∏÷Ä ’£÷Ä’°’Ω’•’∂’µ’°’Ø", "en": "Main Office" },
          "address": "Yerevan, Abovyan 10",
          "coords": { "lat": 40.1776, "lng": 44.5126 },
          "workingHours": { "ru": "–ü–Ω-–ü—Ç 10:00-19:00", "am": "‘µ÷Ä’Ø-’à÷Ç÷Ä’¢ 10:00-19:00", "en": "Mon-Fri 10:00-19:00" }
        }
      ]
    },
    {
      "id": "courier_yerevan",
      "name": {
        "ru": "–ö—É—Ä—å–µ—Ä –ø–æ –ï—Ä–µ–≤–∞–Ω—É",
        "am": "‘±’º’°÷Ñ’´’π ‘µ÷Ä÷á’°’∂’∏÷Ç’¥",
        "en": "Courier in Yerevan"
      },
      "enabled": true,
      "price": 1000,
      "freeAbove": 50000,
      "estimatedDays": 1,
      "icon": "truck",
      "zones": [
        {
          "name": "Yerevan Center",
          "postalCodes": ["0001", "0002", "0009"],
          "price": 1000
        },
        {
          "name": "Yerevan Outskirts",
          "postalCodes": ["0070", "0080"],
          "price": 1500
        }
      ]
    },
    {
      "id": "armenia_regions",
      "name": {
        "ru": "–î–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –ê—Ä–º–µ–Ω–∏–∏",
        "am": "‘±’º’°÷Ñ’∏÷Ç’¥ ’Ä’°’µ’°’Ω’ø’°’∂’∏÷Ç’¥",
        "en": "Armenia regions"
      },
      "enabled": true,
      "price": 3000,
      "freeAbove": null,
      "estimatedDays": 3,
      "icon": "map",
      "excludedRegions": []
    }
  ]
}
```

#### `config/features.json` ‚Äî –≤–∫–ª—é—á–∞–ª–∫–∞ –º–æ–¥—É–ª–µ–π

```json
{
  "catalog": {
    "reviews": false,
    "wishlist": true,
    "compare": false,
    "recentlyViewed": true,
    "relatedProducts": true
  },
  "checkout": {
    "guestCheckout": true,
    "quickCheckout": true,
    "savePaymentMethods": false,
    "giftMessages": false
  },
  "marketing": {
    "coupons": true,
    "loyaltyProgram": false,
    "referralProgram": false,
    "abandonedCartEmails": true
  },
  "content": {
    "blog": true,
    "staticPages": true,
    "faq": true
  },
  "analytics": {
    "ga4": true,
    "facebookPixel": false,
    "tiktokPixel": false
  },
  "integrations": {
    "crm": null,
    "accounting": null,
    "delivery": null
  }
}
```

**–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (`.env.example`):**

```bash
# App
NODE_ENV=production
APP_URL=https://myshop.am
API_URL=https://api.myshop.am

# Database
DATABASE_URL=postgresql://user:password@localhost:5432/myshop

# Redis
REDIS_URL=redis://localhost:6379

# Meilisearch
MEILI_HOST=http://localhost:7700
MEILI_MASTER_KEY=your-master-key

# S3 (Media Storage)
S3_ENDPOINT=https://your-bucket.r2.cloudflarestorage.com
S3_ACCESS_KEY=your-access-key
S3_SECRET_KEY=your-secret-key
S3_BUCKET=myshop-media
S3_PUBLIC_URL=https://cdn.myshop.am

# Payments (—Å–µ–∫—Ä–µ—Ç—ã –∏–∑ config/payments.config.json)
IDRAM_MERCHANT_ID=12345
IDRAM_SECRET_KEY=secret
ARCA_MERCHANT_ID=67890
ARCA_API_KEY=api-key

# Email
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=noreply@myshop.am
SMTP_PASSWORD=password

# SMS
SMS_PROVIDER=twilio
SMS_API_KEY=your-api-key

# JWT
JWT_SECRET=your-jwt-secret
JWT_EXPIRES_IN=7d

# Monitoring
SENTRY_DSN=https://sentry.io/your-dsn
```

**–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –∫–æ–¥–µ:**

```typescript
// apps/api/src/config/brand.config.ts
import brandConfig from '@workspace/config/brand.config.json';

@Injectable()
export class BrandConfigService {
  getColors() {
    return brandConfig.colors;
  }
  
  getLogo(theme: 'light' | 'dark') {
    return brandConfig.logo[theme];
  }
}

// apps/web/src/lib/theme.ts
import { brandConfig } from '@/config';

export const theme = createTheme({
  colors: {
    primary: brandConfig.colors.primary,
    ...
  }
});
```

---

## 4) –î–æ–º–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å (—è–¥—Ä–æ)

**–°—É—â–Ω–æ—Å—Ç–∏**

- `Product(id, slug, title, description, brandId, media[], attrs[], published)`
- `Variant(id, productId, sku, options[], price, compareAt, stock, barcode)`
- `Category(id, parentId, slug, title, meta)`
- `Attribute(id, key, type, localized)` / `AttributeValue(id, attributeId, value)`
- `Cart(id, userId?, items[], totals, coupon?)`
- `Order(id, number, userId?, items[], totals, status, payments[], shipments[], audit)`
- `User(id, email/phone, passwordHash?, roles[], addresses[])`
- `Coupon(id, code, rules, usageLimits, validFrom/To)`

**–ü—Ä–∏–Ω—Ü–∏–ø—ã**

- –í–∞—Ä–∏–∞–Ω—Ç—ã ‚Äî —á–µ—Ä–µ–∑ **—Å–≤–æ–±–æ–¥–Ω—ã–π –Ω–∞–±–æ—Ä –æ–ø—Ü–∏–π** (—Ä–∞–∑–º–µ—Ä/—Ü–≤–µ—Ç/–≤–∫—É—Å/–æ–±—ä–µ–º), –±–µ–∑ –∂—ë—Å—Ç–∫–∏—Ö –ø–æ–ª–µ–π ¬´—Ç–æ–ª—å–∫–æ –æ–¥–µ–∂–¥–∞¬ª.
- –í–µ–∑–¥–µ audit‚Äë–ø–æ–ª—è, soft‚Äëdelete –≥–¥–µ –æ–ø—Ä–∞–≤–¥–∞–Ω–æ.
- –¶–µ–Ω—ã/—Å–∫–∏–¥–∫–∏/–Ω–∞–ª–æ–≥–∏ —Å—á–∏—Ç–∞—é—Ç—Å—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ –Ω–∞ –±—ç–∫–µ.

**DDL (–Ω–∞–±—Ä–æ—Å–æ–∫ –∏–Ω–¥–µ–∫—Å–æ–≤)**

- FK –∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã.
- `products.slug` UNIQUE, `variants.sku` UNIQUE.
- –ò–Ω–¥–µ–∫—Å—ã –Ω–∞ `orders(userId, createdAt)`; `variants(productId)`; GIN/Trigram –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é/–∞—Ä—Ç–∏–∫—É–ª–∞–º.
- Partial index –¥–ª—è soft‚Äëdelete: `WHERE deleted_at IS NULL`.

### 4.1 –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö: —Å—Ç—Ä–∞—Ç–µ–≥–∏—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–≤–æ–¥–æ–≤

**–ó–∞–¥–∞—á–∞:** RU/AM/EN –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤/–∫–∞—Ç–µ–≥–æ—Ä–∏–π/–∞—Ç—Ä–∏–±—É—Ç–æ–≤/–±—Ä–µ–Ω–¥–æ–≤, SEO‚Äë—Å–ª—É–≥–∏ –∏ —Ç–µ–∫—Å—Ç—ã ‚Äî –±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –±–∞–∑–æ–≤–æ–π –∑–∞–ø–∏—Å–∏.

**–ü–æ–¥—Ö–æ–¥:** –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã –ø–µ—Ä–µ–≤–æ–¥–æ–≤ c —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ –∫–ª—é—á–∞–º–∏ –ø–æ `(entity_id, locale)` –∏ –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–º–∏ —Å–ª–∞–≥–∞–º–∏.

**–°—Ö–µ–º–∞ (–ø—Ä–∏–º–µ—Ä):**

```sql
-- —Ç–æ–≤–∞—Ä—ã
CREATE TABLE product_translations (
  id BIGSERIAL PRIMARY KEY,
  product_id BIGINT NOT NULL REFERENCES products(id) ON DELETE CASCADE,
  locale VARCHAR(5) NOT NULL,          -- 'ru', 'am', 'en'
  title TEXT NOT NULL,
  subtitle TEXT,
  description_html TEXT,               -- —Å–∞–Ω–∏—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π HTML/PortableText JSON
  slug TEXT NOT NULL,
  meta JSONB DEFAULT '{}'::jsonb,      -- title/description/og
  CONSTRAINT uq_product_locale UNIQUE(product_id, locale),
  CONSTRAINT uq_product_slug_locale UNIQUE(slug, locale)
);
CREATE INDEX idx_product_trg_title_trgm ON product_translations USING GIN (title gin_trgm_ops);

-- –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
CREATE TABLE category_translations (
  id BIGSERIAL PRIMARY KEY,
  category_id BIGINT NOT NULL REFERENCES categories(id) ON DELETE CASCADE,
  locale VARCHAR(5) NOT NULL,
  title TEXT NOT NULL,
  slug TEXT NOT NULL,                  -- –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —Å–ª–∞–≥
  full_path TEXT NOT NULL,             -- precomputed: 'odezhda/platya'
  meta JSONB DEFAULT '{}'::jsonb,
  CONSTRAINT uq_cat_locale UNIQUE(category_id, locale),
  CONSTRAINT uq_cat_path_locale UNIQUE(full_path, locale)
);
```

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ: `attribute_translations`, `attribute_value_translations`, `brand_translations`.

**URL/SEO:**

- –ü—Ä–µ—Ñ–∏–∫—Å—ã –ª–æ–∫–∞–ª–∏ –≤ –ø—É—Ç–∏: `/am/`, `/ru/`, `/en/`.
- `hreflang` –∏ `canonical` –Ω–∞ –∫–∞–∂–¥—É—é –ª–æ–∫–∞–ª—å.
- –ü—Ä–∏ —Å–º–µ–Ω–µ —Å–ª–∞–≥–∞ —Å–æ–∑–¥–∞—ë–º –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤ `redirects(from_path, to_path, locale, 301)`.

**Fallback:**

- –ï—Å–ª–∏ –ø–µ—Ä–µ–≤–æ–¥–∞ –Ω–µ—Ç, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω—É—é –ª–æ–∫–∞–ª—å + `translationMissing=true`.
- –ü–æ–ª–∏—Ç–∏–∫–∞ fallback –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è: –Ω–∞–ø—Ä–∏–º–µ—Ä, `am -> ru -> en`.

**–ê–¥–º–∏–Ω‚Äë–ø—Ä–æ—Ü–µ—Å—Å—ã:**

- –í–∫–ª–∞–¥–∫–∏ —è–∑—ã–∫–æ–≤ –≤ —Ñ–æ—Ä–º–µ —Ç–æ–≤–∞—Ä–∞; —Å—Ç–∞—Ç—É—Å ¬´–Ω—É–∂–µ–Ω –ø–µ—Ä–µ–≤–æ–¥¬ª; –º–∞—Å—Å–æ–≤—ã–π –∏–º–ø–æ—Ä—Ç/—ç–∫—Å–ø–æ—Ä—Ç CSV/XLSX —Å –∫–æ–ª–æ–Ω–∫–∞–º–∏ `locale`.
- –ü—Ä–æ–≤–µ—Ä–∫–∏: –ø—É—Å—Ç—ã–µ –ø–æ–ª—è –∫–ª—é—á–µ–≤—ã—Ö –ª–æ–∫–∞–ª–µ–π –±–ª–æ–∫–∏—Ä—É—é—Ç –ø—É–±–ª–∏–∫–∞—Ü–∏—é.

**API:**

- –Ø–≤–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä `?lang=am` –∏–ª–∏ `Accept-Language`.
- –í—Å–µ–≥–¥–∞ –æ—Ç–¥–∞—ë–º `localized` –∏ `default` –±–ª–æ–∫–∏ –≤ –æ—Ç–≤–µ—Ç–µ, –µ—Å–ª–∏ –Ω—É–∂–µ–Ω fallback.

**–ü–æ–∏—Å–∫:**

- –û—Ç–¥–µ–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å Meilisearch –Ω–∞ –∫–∞–∂–¥—É—é –ª–æ–∫–∞–ª—å (`products_ru`, `products_am`, `products_en`).
- –°–∏–Ω–æ–Ω–∏–º—ã/–º–æ—Ä—Ñ–æ–ª–æ–≥–∏—è –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –ø–æ —è–∑—ã–∫—É. –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ—Ç –Ω—É–∂–Ω—É—é –∑–∞–ø–∏—Å—å –ø–µ—Ä–µ–≤–æ–¥–∞.

**–°–æ–±—ã—Ç–∏—è –¥–ª—è –∫—ç—à–∞/–ø–æ–∏—Å–∫–∞:** `TranslationCreated/Updated`, `SlugChanged` ‚Üí reindex + –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è HTML/JSON –ø–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º –ª–æ–∫–∞–ª—è–º.

---

### 4.2 –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ö–µ–º–∞ –ë–î (DDL –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü)

**–í—Å–µ —Ç–∞–±–ª–∏—Ü—ã —Å —Ç–æ—á–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏, –∏–Ω–¥–µ–∫—Å–∞–º–∏ –∏ FK –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º–∏–≥—Ä–∞—Ü–∏–π.**

```sql
-- ============================================================
-- BRANDS
-- ============================================================
CREATE TABLE brands (
  id BIGSERIAL PRIMARY KEY,
  slug VARCHAR(255) NOT NULL UNIQUE,
  logo_url TEXT,
  published BOOLEAN DEFAULT false,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  deleted_at TIMESTAMPTZ
);
CREATE INDEX idx_brands_published ON brands(published) WHERE deleted_at IS NULL;

CREATE TABLE brand_translations (
  id BIGSERIAL PRIMARY KEY,
  brand_id BIGINT NOT NULL REFERENCES brands(id) ON DELETE CASCADE,
  locale VARCHAR(5) NOT NULL,
  name VARCHAR(255) NOT NULL,
  description TEXT,
  CONSTRAINT uq_brand_locale UNIQUE(brand_id, locale)
);

-- ============================================================
-- CATEGORIES (nested set –∏–ª–∏ closure table –¥–ª—è –¥–µ—Ä–µ–≤–∞)
-- ============================================================
CREATE TABLE categories (
  id BIGSERIAL PRIMARY KEY,
  parent_id BIGINT REFERENCES categories(id) ON DELETE SET NULL,
  position INTEGER DEFAULT 0,
  published BOOLEAN DEFAULT false,
  media JSONB DEFAULT '[]'::jsonb,           -- [{url, alt, type}]
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  deleted_at TIMESTAMPTZ
);
CREATE INDEX idx_categories_parent ON categories(parent_id) WHERE deleted_at IS NULL;
CREATE INDEX idx_categories_published ON categories(published) WHERE deleted_at IS NULL;

CREATE TABLE category_translations (
  id BIGSERIAL PRIMARY KEY,
  category_id BIGINT NOT NULL REFERENCES categories(id) ON DELETE CASCADE,
  locale VARCHAR(5) NOT NULL,
  title VARCHAR(255) NOT NULL,
  slug VARCHAR(255) NOT NULL,
  full_path TEXT NOT NULL,                   -- precomputed –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö URL
  description TEXT,
  seo_title VARCHAR(255),
  seo_description TEXT,
  CONSTRAINT uq_cat_locale UNIQUE(category_id, locale),
  CONSTRAINT uq_cat_path_locale UNIQUE(full_path, locale)
);
CREATE INDEX idx_cat_trg_slug ON category_translations(slug, locale);

-- ============================================================
-- ATTRIBUTES & VALUES (—Ä–∞–∑–º–µ—Ä, —Ü–≤–µ—Ç, –º–∞—Ç–µ—Ä–∏–∞–ª –∏ —Ç.–¥.)
-- ============================================================
CREATE TABLE attributes (
  id BIGSERIAL PRIMARY KEY,
  key VARCHAR(100) NOT NULL UNIQUE,          -- 'size', 'color', 'material'
  type VARCHAR(50) DEFAULT 'select',         -- select/multiselect/text/number
  filterable BOOLEAN DEFAULT true,           -- –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤ —Ñ–∞—Å–µ—Ç–∞—Ö
  position INTEGER DEFAULT 0,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE TABLE attribute_translations (
  id BIGSERIAL PRIMARY KEY,
  attribute_id BIGINT NOT NULL REFERENCES attributes(id) ON DELETE CASCADE,
  locale VARCHAR(5) NOT NULL,
  name VARCHAR(255) NOT NULL,
  CONSTRAINT uq_attr_locale UNIQUE(attribute_id, locale)
);

CREATE TABLE attribute_values (
  id BIGSERIAL PRIMARY KEY,
  attribute_id BIGINT NOT NULL REFERENCES attributes(id) ON DELETE CASCADE,
  value VARCHAR(255) NOT NULL,               -- –∑–Ω–∞—á–µ–Ω–∏–µ (S/M/L –∏–ª–∏ Red)
  position INTEGER DEFAULT 0,
  CONSTRAINT uq_attr_value UNIQUE(attribute_id, value)
);

CREATE TABLE attribute_value_translations (
  id BIGSERIAL PRIMARY KEY,
  value_id BIGINT NOT NULL REFERENCES attribute_values(id) ON DELETE CASCADE,
  locale VARCHAR(5) NOT NULL,
  label VARCHAR(255) NOT NULL,
  CONSTRAINT uq_attrval_locale UNIQUE(value_id, locale)
);

-- ============================================================
-- PRODUCTS
-- ============================================================
CREATE TABLE products (
  id BIGSERIAL PRIMARY KEY,
  brand_id BIGINT REFERENCES brands(id) ON DELETE SET NULL,
  sku_prefix VARCHAR(50),                    -- –ø—Ä–µ—Ñ–∏–∫—Å –¥–ª—è –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
  media JSONB DEFAULT '[]'::jsonb,           -- [{url, alt, position, type}]
  published BOOLEAN DEFAULT false,
  featured BOOLEAN DEFAULT false,            -- "—Ö–∏—Ç –ø—Ä–æ–¥–∞–∂"
  published_at TIMESTAMPTZ,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  deleted_at TIMESTAMPTZ
);
CREATE INDEX idx_products_brand ON products(brand_id) WHERE deleted_at IS NULL;
CREATE INDEX idx_products_published ON products(published, published_at) WHERE deleted_at IS NULL;
CREATE INDEX idx_products_featured ON products(featured) WHERE published = true AND deleted_at IS NULL;

CREATE TABLE product_translations (
  id BIGSERIAL PRIMARY KEY,
  product_id BIGINT NOT NULL REFERENCES products(id) ON DELETE CASCADE,
  locale VARCHAR(5) NOT NULL,
  title TEXT NOT NULL,
  slug VARCHAR(255) NOT NULL,
  subtitle TEXT,
  description_html TEXT,
  seo_title VARCHAR(255),
  seo_description TEXT,
  CONSTRAINT uq_product_locale UNIQUE(product_id, locale),
  CONSTRAINT uq_product_slug_locale UNIQUE(slug, locale)
);
CREATE INDEX idx_product_trg_slug ON product_translations(slug, locale);
CREATE INDEX idx_product_trg_title_trgm ON product_translations USING GIN (title gin_trgm_ops);

-- ============================================================
-- PRODUCT ‚Üî CATEGORY (many-to-many)
-- ============================================================
CREATE TABLE product_categories (
  product_id BIGINT NOT NULL REFERENCES products(id) ON DELETE CASCADE,
  category_id BIGINT NOT NULL REFERENCES categories(id) ON DELETE CASCADE,
  is_primary BOOLEAN DEFAULT false,
  PRIMARY KEY (product_id, category_id)
);
CREATE INDEX idx_prod_cat_category ON product_categories(category_id);

-- ============================================================
-- PRODUCT ‚Üî ATTRIBUTE (–∫–∞–∫–∏–µ –∞—Ç—Ä–∏–±—É—Ç—ã —É —Ç–æ–≤–∞—Ä–∞)
-- ============================================================
CREATE TABLE product_attributes (
  product_id BIGINT NOT NULL REFERENCES products(id) ON DELETE CASCADE,
  attribute_id BIGINT NOT NULL REFERENCES attributes(id) ON DELETE CASCADE,
  PRIMARY KEY (product_id, attribute_id)
);

-- ============================================================
-- VARIANTS (SKU, —Ü–µ–Ω–∞, –æ—Å—Ç–∞—Ç–æ–∫)
-- ============================================================
CREATE TABLE variants (
  id BIGSERIAL PRIMARY KEY,
  product_id BIGINT NOT NULL REFERENCES products(id) ON DELETE CASCADE,
  sku VARCHAR(100) NOT NULL UNIQUE,
  barcode VARCHAR(100),
  price DECIMAL(10, 2) NOT NULL,
  compare_at_price DECIMAL(10, 2),           -- –∑–∞—á–µ—Ä–∫–Ω—É—Ç–∞—è —Ü–µ–Ω–∞
  cost DECIMAL(10, 2),                       -- —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å
  stock INTEGER DEFAULT 0,
  stock_reserved INTEGER DEFAULT 0,          -- –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–æ –≤ –∑–∞–∫–∞–∑–∞—Ö
  weight_grams INTEGER,
  image_url TEXT,                            -- –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ —Å–≤–æ—ë —Ñ–æ—Ç–æ
  position INTEGER DEFAULT 0,
  published BOOLEAN DEFAULT true,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);
CREATE INDEX idx_variants_product ON variants(product_id);
CREATE INDEX idx_variants_sku ON variants(sku);
CREATE INDEX idx_variants_stock ON variants(stock) WHERE published = true;

-- ============================================================
-- VARIANT OPTIONS (—Ä–∞–∑–º–µ—Ä=M, —Ü–≤–µ—Ç=Red)
-- ============================================================
CREATE TABLE variant_options (
  id BIGSERIAL PRIMARY KEY,
  variant_id BIGINT NOT NULL REFERENCES variants(id) ON DELETE CASCADE,
  attribute_id BIGINT NOT NULL REFERENCES attributes(id) ON DELETE CASCADE,
  value_id BIGINT NOT NULL REFERENCES attribute_values(id) ON DELETE CASCADE,
  CONSTRAINT uq_variant_attr UNIQUE(variant_id, attribute_id)
);
CREATE INDEX idx_variant_opt_variant ON variant_options(variant_id);

-- ============================================================
-- USERS
-- ============================================================
CREATE TABLE users (
  id BIGSERIAL PRIMARY KEY,
  email VARCHAR(255) UNIQUE,
  phone VARCHAR(50) UNIQUE,
  password_hash TEXT,                        -- Argon2id
  first_name VARCHAR(100),
  last_name VARCHAR(100),
  email_verified BOOLEAN DEFAULT false,
  phone_verified BOOLEAN DEFAULT false,
  locale VARCHAR(5) DEFAULT 'ru',
  blocked BOOLEAN DEFAULT false,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  deleted_at TIMESTAMPTZ,
  CONSTRAINT user_login_check CHECK (email IS NOT NULL OR phone IS NOT NULL)
);
CREATE INDEX idx_users_email ON users(email) WHERE deleted_at IS NULL;
CREATE INDEX idx_users_phone ON users(phone) WHERE deleted_at IS NULL;

-- ============================================================
-- USER ROLES (RBAC)
-- ============================================================
CREATE TABLE roles (
  id SERIAL PRIMARY KEY,
  name VARCHAR(50) NOT NULL UNIQUE,          -- admin, manager, customer
  permissions JSONB DEFAULT '[]'::jsonb      -- ['products.edit', 'orders.view']
);

CREATE TABLE user_roles (
  user_id BIGINT NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  role_id INTEGER NOT NULL REFERENCES roles(id) ON DELETE CASCADE,
  PRIMARY KEY (user_id, role_id)
);

-- ============================================================
-- USER ADDRESSES
-- ============================================================
CREATE TABLE addresses (
  id BIGSERIAL PRIMARY KEY,
  user_id BIGINT NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  first_name VARCHAR(100),
  last_name VARCHAR(100),
  company VARCHAR(255),
  address_line1 TEXT NOT NULL,
  address_line2 TEXT,
  city VARCHAR(100) NOT NULL,
  state VARCHAR(100),
  postal_code VARCHAR(20),
  country_code VARCHAR(2) DEFAULT 'AM',
  phone VARCHAR(50),
  is_default BOOLEAN DEFAULT false,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);
CREATE INDEX idx_addresses_user ON addresses(user_id);

-- ============================================================
-- CARTS
-- ============================================================
CREATE TABLE carts (
  id BIGSERIAL PRIMARY KEY,
  user_id BIGINT REFERENCES users(id) ON DELETE CASCADE,
  guest_token UUID UNIQUE,                   -- –¥–ª—è –≥–æ—Å—Ç–µ–π
  locale VARCHAR(5) DEFAULT 'ru',
  coupon_code VARCHAR(100),
  abandoned BOOLEAN DEFAULT false,
  abandoned_at TIMESTAMPTZ,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  expires_at TIMESTAMPTZ DEFAULT NOW() + INTERVAL '30 days',
  CONSTRAINT cart_owner_check CHECK (user_id IS NOT NULL OR guest_token IS NOT NULL)
);
CREATE INDEX idx_carts_user ON carts(user_id);
CREATE INDEX idx_carts_guest ON carts(guest_token);
CREATE INDEX idx_carts_abandoned ON carts(abandoned, abandoned_at) WHERE abandoned = true;

CREATE TABLE cart_items (
  id BIGSERIAL PRIMARY KEY,
  cart_id BIGINT NOT NULL REFERENCES carts(id) ON DELETE CASCADE,
  variant_id BIGINT NOT NULL REFERENCES variants(id) ON DELETE CASCADE,
  quantity INTEGER NOT NULL CHECK (quantity > 0),
  price_snapshot DECIMAL(10, 2) NOT NULL,    -- —Ü–µ–Ω–∞ –Ω–∞ –º–æ–º–µ–Ω—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  CONSTRAINT uq_cart_variant UNIQUE(cart_id, variant_id)
);
CREATE INDEX idx_cart_items_cart ON cart_items(cart_id);

-- ============================================================
-- ORDERS
-- ============================================================
CREATE TABLE orders (
  id BIGSERIAL PRIMARY KEY,
  number VARCHAR(50) NOT NULL UNIQUE,        -- —á–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º—ã–π –Ω–æ–º–µ—Ä
  user_id BIGINT REFERENCES users(id) ON DELETE SET NULL,
  status VARCHAR(50) NOT NULL DEFAULT 'pending',
  payment_status VARCHAR(50) DEFAULT 'pending',
  fulfillment_status VARCHAR(50) DEFAULT 'unfulfilled',
  
  -- –§–∏–Ω–∞–Ω—Å—ã
  subtotal DECIMAL(10, 2) NOT NULL,
  discount_amount DECIMAL(10, 2) DEFAULT 0,
  shipping_amount DECIMAL(10, 2) DEFAULT 0,
  tax_amount DECIMAL(10, 2) DEFAULT 0,
  total DECIMAL(10, 2) NOT NULL,
  currency VARCHAR(3) DEFAULT 'AMD',
  
  -- –ö–æ–Ω—Ç–∞–∫—Ç—ã
  customer_email VARCHAR(255),
  customer_phone VARCHAR(50),
  customer_locale VARCHAR(5) DEFAULT 'ru',
  
  -- –ê–¥—Ä–µ—Å–∞
  billing_address JSONB,                     -- {first_name, last_name, address...}
  shipping_address JSONB,
  
  -- –î–æ—Å—Ç–∞–≤–∫–∞
  shipping_method VARCHAR(100),
  tracking_number VARCHAR(255),
  
  -- –ü—Ä–æ—á–µ–µ
  notes TEXT,                                -- –∑–∞–º–µ—Ç–∫–∏ –∫–ª–∏–µ–Ω—Ç–∞
  admin_notes TEXT,                          -- –∑–∞–º–µ—Ç–∫–∏ –º–µ–Ω–µ–¥–∂–µ—Ä–∞
  ip_address INET,
  user_agent TEXT,
  
  -- Timestamps
  paid_at TIMESTAMPTZ,
  fulfilled_at TIMESTAMPTZ,
  cancelled_at TIMESTAMPTZ,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);
CREATE INDEX idx_orders_user ON orders(user_id);
CREATE INDEX idx_orders_number ON orders(number);
CREATE INDEX idx_orders_status ON orders(status, created_at);
CREATE INDEX idx_orders_email ON orders(customer_email);
CREATE INDEX idx_orders_created ON orders(created_at DESC);

-- ============================================================
-- ORDER ITEMS
-- ============================================================
CREATE TABLE order_items (
  id BIGSERIAL PRIMARY KEY,
  order_id BIGINT NOT NULL REFERENCES orders(id) ON DELETE CASCADE,
  variant_id BIGINT REFERENCES variants(id) ON DELETE SET NULL,
  
  -- Snapshot –¥–∞–Ω–Ω—ã—Ö (–Ω–∞ –º–æ–º–µ–Ω—Ç –∑–∞–∫–∞–∑–∞)
  product_title VARCHAR(255) NOT NULL,
  variant_title VARCHAR(255),
  sku VARCHAR(100) NOT NULL,
  quantity INTEGER NOT NULL CHECK (quantity > 0),
  price DECIMAL(10, 2) NOT NULL,
  total DECIMAL(10, 2) NOT NULL,
  image_url TEXT,
  
  created_at TIMESTAMPTZ DEFAULT NOW()
);
CREATE INDEX idx_order_items_order ON order_items(order_id);
CREATE INDEX idx_order_items_variant ON order_items(variant_id);

-- ============================================================
-- ORDER EVENTS (audit log / event sourcing)
-- ============================================================
CREATE TABLE order_events (
  id BIGSERIAL PRIMARY KEY,
  order_id BIGINT NOT NULL REFERENCES orders(id) ON DELETE CASCADE,
  type VARCHAR(100) NOT NULL,                -- 'order.created', 'payment.completed'
  data JSONB NOT NULL,
  user_id BIGINT REFERENCES users(id) ON DELETE SET NULL,
  ip_address INET,
  created_at TIMESTAMPTZ DEFAULT NOW()
);
CREATE INDEX idx_order_events_order ON order_events(order_id, created_at);
CREATE INDEX idx_order_events_type ON order_events(type);

-- ============================================================
-- PAYMENTS
-- ============================================================
CREATE TABLE payments (
  id BIGSERIAL PRIMARY KEY,
  order_id BIGINT NOT NULL REFERENCES orders(id) ON DELETE CASCADE,
  provider VARCHAR(50) NOT NULL,             -- 'idram', 'arca', 'stripe'
  provider_transaction_id VARCHAR(255),
  method VARCHAR(50),                        -- 'card', 'wallet', 'terminal'
  amount DECIMAL(10, 2) NOT NULL,
  currency VARCHAR(3) DEFAULT 'AMD',
  status VARCHAR(50) DEFAULT 'pending',      -- pending/completed/failed/refunded
  
  -- Metadata
  card_last4 VARCHAR(4),
  card_brand VARCHAR(50),
  error_code VARCHAR(100),
  error_message TEXT,
  
  provider_response JSONB,                   -- raw –¥–∞–Ω–Ω—ã–µ –æ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
  idempotency_key UUID,
  
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  completed_at TIMESTAMPTZ,
  failed_at TIMESTAMPTZ
);
CREATE INDEX idx_payments_order ON payments(order_id);
CREATE INDEX idx_payments_provider_txn ON payments(provider, provider_transaction_id);
CREATE INDEX idx_payments_status ON payments(status);

-- ============================================================
-- COUPONS
-- ============================================================
CREATE TABLE coupons (
  id BIGSERIAL PRIMARY KEY,
  code VARCHAR(100) NOT NULL UNIQUE,
  type VARCHAR(50) NOT NULL,                 -- 'percentage', 'fixed_amount', 'free_shipping'
  value DECIMAL(10, 2),                      -- 10 (–¥–ª—è 10%) –∏–ª–∏ 5000 (–¥–ª—è 5000 AMD)
  
  -- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
  min_order_amount DECIMAL(10, 2),
  max_discount_amount DECIMAL(10, 2),
  usage_limit INTEGER,                       -- –æ–±—â–∏–π –ª–∏–º–∏—Ç
  usage_limit_per_user INTEGER,
  usage_count INTEGER DEFAULT 0,
  
  -- –ü—Ä–∏–º–µ–Ω–∏–º–æ—Å—Ç—å
  applies_to VARCHAR(50) DEFAULT 'all',      -- 'all', 'categories', 'products'
  target_ids BIGINT[],                       -- ID –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏–ª–∏ —Ç–æ–≤–∞—Ä–æ–≤
  
  -- –ü–µ—Ä–∏–æ–¥ –¥–µ–π—Å—Ç–≤–∏—è
  valid_from TIMESTAMPTZ,
  valid_to TIMESTAMPTZ,
  
  active BOOLEAN DEFAULT true,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);
CREATE INDEX idx_coupons_code ON coupons(code) WHERE active = true;

-- ============================================================
-- COUPON USAGE (–∏—Å—Ç–æ—Ä–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
-- ============================================================
CREATE TABLE coupon_usages (
  id BIGSERIAL PRIMARY KEY,
  coupon_id BIGINT NOT NULL REFERENCES coupons(id) ON DELETE CASCADE,
  user_id BIGINT REFERENCES users(id) ON DELETE SET NULL,
  order_id BIGINT REFERENCES orders(id) ON DELETE CASCADE,
  discount_amount DECIMAL(10, 2) NOT NULL,
  created_at TIMESTAMPTZ DEFAULT NOW()
);
CREATE INDEX idx_coupon_usage_coupon ON coupon_usages(coupon_id);
CREATE INDEX idx_coupon_usage_user ON coupon_usages(user_id);

-- ============================================================
-- IDEMPOTENCY KEYS (–¥–ª—è checkout –∏ –ø–ª–∞—Ç–µ–∂–µ–π)
-- ============================================================
CREATE TABLE idempotency_keys (
  key UUID PRIMARY KEY,
  request_hash TEXT NOT NULL,                -- hash —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞
  response JSONB NOT NULL,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  expires_at TIMESTAMPTZ DEFAULT NOW() + INTERVAL '24 hours'
);
CREATE INDEX idx_idempotency_expires ON idempotency_keys(expires_at);

-- ============================================================
-- REDIRECTS (–¥–ª—è SEO –ø—Ä–∏ —Å–º–µ–Ω–µ URL)
-- ============================================================
CREATE TABLE redirects (
  id BIGSERIAL PRIMARY KEY,
  from_path TEXT NOT NULL,
  to_path TEXT NOT NULL,
  locale VARCHAR(5),
  status_code SMALLINT DEFAULT 301,
  hit_count INTEGER DEFAULT 0,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  CONSTRAINT uq_redirect_from UNIQUE(from_path, locale)
);
CREATE INDEX idx_redirects_from ON redirects(from_path, locale);
```

**–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ —Å—Ö–µ–º–µ:**

- **Soft delete**: `deleted_at` –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö; partial index –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.
- **Audit fields**: –≤–µ–∑–¥–µ `created_at`, `updated_at`; –≤ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å `created_by`, `updated_by`.
- **Snapshot –¥–∞–Ω–Ω—ã–µ**: –≤ `order_items` —Ö—Ä–∞–Ω—è—Ç—Å—è title/price –Ω–∞ –º–æ–º–µ–Ω—Ç –∑–∞–∫–∞–∑–∞ (–∑–∞—â–∏—Ç–∞ –æ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞).
- **JSONB**: –¥–ª—è –≥–∏–±–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö (–∞–¥—Ä–µ—Å–∞, meta, provider_response) –±–µ–∑ —Å—Ö–µ–º–Ω—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π.
- **Event sourcing**: `order_events` —Ö—Ä–∞–Ω–∏—Ç –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π –∑–∞–∫–∞–∑–∞ –¥–ª—è –∞—É–¥–∏—Ç–∞.
- **Idempotency**: –æ—Ç–¥–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å TTL –¥–ª—è –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∏ —Å—Ç–∞—Ä—ã—Ö –∫–ª—é—á–µ–π.

---

## 5) API –¥–∏–∑–∞–π–Ω

**–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ:** `/api/v1/...`\
**–°—Ç–∞–Ω–¥–∞—Ä—Ç—ã:**

- –§–æ—Ä–º–∞—Ç –æ—à–∏–±–æ–∫ ‚Äî RFC 7807 (`application/problem+json`).
- –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å: –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Idempotency-Key` –Ω–∞ POST `/checkout` –∏ –ø–ª–∞—Ç–µ–∂–∏.
- –ü–∞–≥–∏–Ω–∞—Ü–∏—è: `limit/offset` –∏–ª–∏ cursor, whitelisted —Ñ–∏–ª—å—Ç—Ä—ã –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏.
- –ö—ç—à GET: `ETag/Last-Modified` + 304.
- OpenAPI 3.1 —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è; –≥–µ–Ω–µ—Ä–∞—Ü–∏—è SDK –∫–ª–∏–µ–Ω—Ç–∞.

**–ü—Ä–∏–º–µ—Ä—ã —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤**

- GET `/products?query=&category=&filters=&sort=&page=`
- GET `/products/{slug}`
- GET `/categories/tree`
- POST `/cart/items` | PATCH `/cart/items/{id}` | DELETE `/cart/items/{id}`
- POST `/checkout` ‚Üí –≤–æ–∑–≤—Ä–∞—Ç `orderId`, `paymentUrl`/`paymentClientSecret`
- POST `/payments/webhook/idram` | `/payments/webhook/arca` (–ø–æ–¥–ø–∏—Å—å/–ø—Ä–æ–≤–µ—Ä–∫–∞)
- GET `/orders/{number}` (–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∑–æ–Ω–∞)

**DTO/–≤–∞–ª–∏–¥–∞—Ü–∏–∏**: class‚Äëvalidator –Ω–∞ –∫–∞–∂–¥–æ–µ –ø–æ–ª–µ, —Å—Ç—Ä–æ–≥–∏–µ —Å—Ö–µ–º—ã, canonicalization.

### 5.1 –ü—Ä–∏–º–µ—Ä—ã API –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤

**–ó–∞—á–µ–º:** —á—ë—Ç–∫–∏–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã API –∑–∞—â–∏—â–∞—é—Ç –æ—Ç –Ω–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –æ–∂–∏–¥–∞–Ω–∏–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –∏ –±—ç–∫–µ–Ω–¥–∞, –æ–±–ª–µ–≥—á–∞—é—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏—é SDK –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.

#### **GET /api/v1/products/{slug} ‚Äî –î–µ—Ç–∞–ª–∏ —Ç–æ–≤–∞—Ä–∞**

**Request:**
```http
GET /api/v1/products/red-tshirt?lang=ru HTTP/1.1
Host: api.myshop.am
Accept: application/json
Accept-Language: ru
```

**Response 200 OK:**
```json
{
  "id": 123,
  "slug": "red-tshirt",
  "title": "–ö—Ä–∞—Å–Ω–∞—è —Ñ—É—Ç–±–æ–ª–∫–∞",
  "subtitle": "–ë–∞–∑–æ–≤–∞—è –º–æ–¥–µ–ª—å",
  "description": "<p>–£–¥–æ–±–Ω–∞—è —Ö–ª–æ–ø–∫–æ–≤–∞—è —Ñ—É—Ç–±–æ–ª–∫–∞...</p>",
  "brand": {
    "id": 5,
    "slug": "nike",
    "name": "Nike",
    "logo": "https://cdn.myshop.am/brands/nike.svg"
  },
  "categories": [
    {
      "id": 10,
      "slug": "odezhda/futbolki",
      "title": "–§—É—Ç–±–æ–ª–∫–∏",
      "breadcrumb": [
        { "id": 1, "slug": "odezhda", "title": "–û–¥–µ–∂–¥–∞" },
        { "id": 10, "slug": "odezhda/futbolki", "title": "–§—É—Ç–±–æ–ª–∫–∏" }
      ]
    }
  ],
  "media": [
    {
      "url": "https://cdn.myshop.am/products/red-tshirt-1.jpg",
      "alt": "–ö—Ä–∞—Å–Ω–∞—è —Ñ—É—Ç–±–æ–ª–∫–∞ —Å–ø–µ—Ä–µ–¥–∏",
      "position": 1,
      "type": "image"
    }
  ],
  "variants": [
    {
      "id": 456,
      "sku": "TSH-RED-S",
      "price": 5000,
      "compareAtPrice": 7000,
      "stock": 10,
      "options": [
        { "attribute": "–†–∞–∑–º–µ—Ä", "value": "S", "key": "size" },
        { "attribute": "–¶–≤–µ—Ç", "value": "–ö—Ä–∞—Å–Ω—ã–π", "key": "color" }
      ],
      "available": true
    },
    {
      "id": 457,
      "sku": "TSH-RED-M",
      "price": 5000,
      "stock": 0,
      "options": [
        { "attribute": "–†–∞–∑–º–µ—Ä", "value": "M", "key": "size" },
        { "attribute": "–¶–≤–µ—Ç", "value": "–ö—Ä–∞—Å–Ω—ã–π", "key": "color" }
      ],
      "available": false
    }
  ],
  "attributes": [
    {
      "key": "material",
      "name": "–ú–∞—Ç–µ—Ä–∏–∞–ª",
      "value": "100% —Ö–ª–æ–ø–æ–∫"
    }
  ],
  "seo": {
    "title": "–ö—Ä–∞—Å–Ω–∞—è —Ñ—É—Ç–±–æ–ª–∫–∞ Nike ‚Äî –∫—É–ø–∏—Ç—å –≤ –ï—Ä–µ–≤–∞–Ω–µ",
    "description": "–ë–∞–∑–æ–≤–∞—è —Ö–ª–æ–ø–∫–æ–≤–∞—è —Ñ—É—Ç–±–æ–ª–∫–∞ Nike. –î–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –ê—Ä–º–µ–Ω–∏–∏."
  },
  "published": true,
  "publishedAt": "2025-01-15T10:00:00Z",
  "createdAt": "2025-01-10T12:00:00Z",
  "updatedAt": "2025-01-20T14:30:00Z"
}
```

**Response 404 Not Found:**
```json
{
  "type": "https://api.myshop.am/problems/not-found",
  "title": "Product not found",
  "status": 404,
  "detail": "Product with slug 'red-tshirt' does not exist or is not published",
  "instance": "/api/v1/products/red-tshirt"
}
```

---

#### **GET /api/v1/products ‚Äî –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ (–∫–∞—Ç–∞–ª–æ–≥)**

**Request:**
```http
GET /api/v1/products?category=odezhda&filters[size]=M,L&filters[color]=red&sort=price_asc&page=1&limit=24&lang=ru HTTP/1.1
```

**Response 200 OK:**
```json
{
  "data": [
    {
      "id": 123,
      "slug": "red-tshirt",
      "title": "–ö—Ä–∞—Å–Ω–∞—è —Ñ—É—Ç–±–æ–ª–∫–∞",
      "brand": { "id": 5, "name": "Nike" },
      "price": 5000,
      "compareAtPrice": 7000,
      "image": "https://cdn.myshop.am/products/red-tshirt-thumb.jpg",
      "badge": "sale",
      "inStock": true
    }
  ],
  "meta": {
    "total": 156,
    "page": 1,
    "limit": 24,
    "totalPages": 7
  },
  "facets": {
    "size": [
      { "value": "S", "count": 23 },
      { "value": "M", "count": 45, "selected": true },
      { "value": "L", "count": 38, "selected": true }
    ],
    "color": [
      { "value": "red", "label": "–ö—Ä–∞—Å–Ω—ã–π", "count": 12, "selected": true },
      { "value": "blue", "label": "–°–∏–Ω–∏–π", "count": 34 }
    ],
    "price": {
      "min": 2000,
      "max": 50000,
      "currentMin": null,
      "currentMax": null
    }
  }
}
```

---

#### **POST /api/v1/cart/items ‚Äî –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É**

**Request:**
```http
POST /api/v1/cart/items HTTP/1.1
Content-Type: application/json
X-Guest-Token: 550e8400-e29b-41d4-a716-446655440000

{
  "variantId": 456,
  "quantity": 2
}
```

**Response 201 Created:**
```json
{
  "cart": {
    "id": 789,
    "items": [
      {
        "id": 1001,
        "variant": {
          "id": 456,
          "sku": "TSH-RED-S",
          "product": {
            "id": 123,
            "title": "–ö—Ä–∞—Å–Ω–∞—è —Ñ—É—Ç–±–æ–ª–∫–∞",
            "slug": "red-tshirt",
            "image": "https://cdn.myshop.am/products/red-tshirt-thumb.jpg"
          },
          "options": [
            { "attribute": "–†–∞–∑–º–µ—Ä", "value": "S" }
          ]
        },
        "quantity": 2,
        "price": 5000,
        "total": 10000
      }
    ],
    "totals": {
      "subtotal": 10000,
      "discount": 0,
      "shipping": 1000,
      "tax": 0,
      "total": 11000,
      "currency": "AMD"
    },
    "itemsCount": 2
  }
}
```

**Response 422 Unprocessable Entity:**
```json
{
  "type": "https://api.myshop.am/problems/validation-error",
  "title": "Validation failed",
  "status": 422,
  "errors": [
    {
      "field": "quantity",
      "message": "Requested quantity (10) exceeds available stock (3)",
      "code": "insufficient_stock"
    }
  ]
}
```

---

#### **POST /api/v1/checkout ‚Äî –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑**

**Request:**
```http
POST /api/v1/checkout HTTP/1.1
Content-Type: application/json
Idempotency-Key: 550e8400-e29b-41d4-a716-446655440001

{
  "cartId": 789,
  "email": "customer@example.com",
  "phone": "+37477123456",
  "shippingAddress": {
    "firstName": "–ò–≤–∞–Ω",
    "lastName": "–ò–≤–∞–Ω–æ–≤",
    "addressLine1": "—É–ª. –ê–±–æ–≤—è–Ω–∞ 10",
    "city": "–ï—Ä–µ–≤–∞–Ω",
    "postalCode": "0001",
    "countryCode": "AM"
  },
  "billingAddress": null,
  "shippingMethod": "courier_yerevan",
  "paymentMethod": "idram",
  "notes": "–ü–æ–∑–≤–æ–Ω–∏—Ç—å –∑–∞ —á–∞—Å –¥–æ –¥–æ—Å—Ç–∞–≤–∫–∏",
  "acceptTerms": true
}
```

**Response 201 Created:**
```json
{
  "order": {
    "id": 9876,
    "number": "250207-00123",
    "status": "pending",
    "paymentStatus": "pending",
    "total": 11000,
    "currency": "AMD",
    "createdAt": "2025-02-07T14:35:00Z"
  },
  "payment": {
    "provider": "idram",
    "paymentUrl": "https://banking.idram.am/payment?token=abc123",
    "expiresAt": "2025-02-07T14:50:00Z"
  },
  "nextAction": "redirect",
  "redirectUrl": "https://banking.idram.am/payment?token=abc123"
}
```

**Response 400 Bad Request (–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å):**
```json
{
  "type": "https://api.myshop.am/problems/idempotency-mismatch",
  "title": "Idempotency key already used",
  "status": 400,
  "detail": "This idempotency key was already used with different request data",
  "existingOrderNumber": "250207-00122"
}
```

---

#### **POST /api/v1/payments/webhook/idram ‚Äî –í–µ–±—Ö—É–∫ –ø–ª–∞—Ç–µ–∂–∞**

**Request (–æ—Ç Idram):**
```http
POST /api/v1/payments/webhook/idram HTTP/1.1
Content-Type: application/json
X-Idram-Signature: sha256=abc123...

{
  "transactionId": "IDR-12345678",
  "merchantOrderId": "9876",
  "status": "success",
  "amount": 11000,
  "currency": "AMD",
  "cardMask": "****1234",
  "cardType": "VISA",
  "timestamp": "2025-02-07T14:40:00Z"
}
```

**Response 200 OK:**
```json
{
  "received": true,
  "orderId": "250207-00123"
}
```

---

#### **GET /api/v1/orders/{number} ‚Äî –î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞**

**Request:**
```http
GET /api/v1/orders/250207-00123 HTTP/1.1
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

**Response 200 OK:**
```json
{
  "id": 9876,
  "number": "250207-00123",
  "status": "confirmed",
  "paymentStatus": "paid",
  "fulfillmentStatus": "unfulfilled",
  "items": [
    {
      "id": 10001,
      "productTitle": "–ö—Ä–∞—Å–Ω–∞—è —Ñ—É—Ç–±–æ–ª–∫–∞",
      "variantTitle": "S / –ö—Ä–∞—Å–Ω—ã–π",
      "sku": "TSH-RED-S",
      "quantity": 2,
      "price": 5000,
      "total": 10000,
      "image": "https://cdn.myshop.am/products/red-tshirt-thumb.jpg"
    }
  ],
  "totals": {
    "subtotal": 10000,
    "discount": 0,
    "shipping": 1000,
    "tax": 0,
    "total": 11000,
    "currency": "AMD"
  },
  "customer": {
    "email": "customer@example.com",
    "phone": "+37477123456"
  },
  "shippingAddress": {
    "firstName": "–ò–≤–∞–Ω",
    "lastName": "–ò–≤–∞–Ω–æ–≤",
    "addressLine1": "—É–ª. –ê–±–æ–≤—è–Ω–∞ 10",
    "city": "–ï—Ä–µ–≤–∞–Ω",
    "postalCode": "0001",
    "countryCode": "AM"
  },
  "shippingMethod": "–ö—É—Ä—å–µ—Ä –ø–æ –ï—Ä–µ–≤–∞–Ω—É",
  "trackingNumber": null,
  "timeline": [
    {
      "status": "created",
      "timestamp": "2025-02-07T14:35:00Z",
      "note": "–ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω"
    },
    {
      "status": "paid",
      "timestamp": "2025-02-07T14:40:00Z",
      "note": "–û–ø–ª–∞—Ç–∞ –ø–æ–ª—É—á–µ–Ω–∞"
    },
    {
      "status": "confirmed",
      "timestamp": "2025-02-07T14:41:00Z",
      "note": "–ó–∞–∫–∞–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω"
    }
  ],
  "createdAt": "2025-02-07T14:35:00Z",
  "updatedAt": "2025-02-07T14:41:00Z"
}
```

---

#### **GET /api/v1/search ‚Äî –ì–ª–æ–±–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫**

**Request:**
```http
GET /api/v1/search?q=–∫—Ä–∞—Å–Ω–∞—è+—Ñ—É—Ç–±–æ–ª–∫–∞&lang=ru&limit=20 HTTP/1.1
```

**Response 200 OK:**
```json
{
  "query": "–∫—Ä–∞—Å–Ω–∞—è —Ñ—É—Ç–±–æ–ª–∫–∞",
  "processingTimeMs": 12,
  "hits": [
    {
      "id": "123",
      "type": "product",
      "title": "–ö—Ä–∞—Å–Ω–∞—è <em>—Ñ—É—Ç–±–æ–ª–∫–∞</em> Nike",
      "slug": "red-tshirt",
      "price": 5000,
      "image": "https://cdn.myshop.am/products/red-tshirt-thumb.jpg",
      "inStock": true,
      "score": 0.98
    }
  ],
  "facets": {
    "category": [
      { "value": "odezhda", "label": "–û–¥–µ–∂–¥–∞", "count": 45 }
    ]
  },
  "total": 45,
  "estimatedTotalHits": 45
}
```

---

**–û–±—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –æ—Ç–≤–µ—Ç–æ–≤:**

1. **–£—Å–ø–µ—Ö (2xx):** –≤—Å–µ–≥–¥–∞ JSON —Å –¥–∞–Ω–Ω—ã–º–∏
2. **–û—à–∏–±–∫–∏ –∫–ª–∏–µ–Ω—Ç–∞ (4xx):** RFC 7807 Problem Details
3. **–û—à–∏–±–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞ (5xx):** –º–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–µ—Ç–∞–ª–∏ (–Ω–µ —Ä–∞—Å–∫—Ä—ã–≤–∞—Ç—å —Å—Ç–µ–∫)
4. **Timestamps:** ISO 8601 UTC (`2025-02-07T14:35:00Z`)
5. **–¶–µ–Ω—ã:** integer (–∫–æ–ø–µ–π–∫–∏/–¥—Ä–∞–º—ã), –±–µ–∑ float
6. **–õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è:** —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä `?lang=` –∏–ª–∏ `Accept-Language`
7. **–ü–∞–≥–∏–Ω–∞—Ü–∏—è:** `page/limit` + –º–µ—Ç–∞-–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
8. **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å:** –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Idempotency-Key` –Ω–∞ POST/PATCH

---

## 6) Checkout, –æ–ø–ª–∞—Ç–∞, –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å

**–ü—Ä–∞–≤–∏–ª–∞**

- –ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ —Å—Ç–∞—Ç—É—Å–µ `pending` —Å `reservationTTL=15min`.
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –∑–∞–ø–∏—Å–∏ idempotent. –ü–æ–≤—Ç–æ—Ä –∑–∞–ø—Ä–æ—Å–∞ —Å —Ç–µ–º –∂–µ `Idempotency-Key` –Ω–µ —Å–æ–∑–¥–∞—ë—Ç –¥—É–±–ª—å.
- Webhook –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç—Å—è –ø–æ –ø–æ–¥–ø–∏—Å–∏; –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–∞.

**–ü—Å–µ–≤–¥–æ–∫–æ–¥ idempotent –æ–±—Ä–∞–±–æ—Ç–∫–∏**

```ts
async function createOrder(req) {
  const key = req.headers['Idempotency-Key'];
  const existing = await idempotencyStore.get(key);
  if (existing) return existing.response;

  return await withTransaction(async (tx) => {
    const order = await tx.orders.create(pendingFromCart(req.user, req.body));
    await reserveStock(tx, order.items, { ttl: 15 * 60 });
    const payment = await payments.init(order, req.body.method);
    const resp = { orderId: order.number, payment }; 
    await idempotencyStore.put(key, resp);
    return resp;
  });
}
```

### 6.1 –°—Ö–µ–º–∞ —Å—Ç–∞—Ç—É—Å–æ–≤ –∑–∞–∫–∞–∑–∞ (state machine)

**–ó–∞—á–µ–º:** —á—ë—Ç–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –∑–∞—â–∏—â–∞—é—Ç –æ—Ç –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫ –∏ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—é—Ç –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å.

**–¢—Ä–∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –æ—Å–∏ —Å—Ç–∞—Ç—É—Å–æ–≤:**

1. **Order Status** (–æ–±—â–∏–π —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞)
2. **Payment Status** (—Å—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç—ã)
3. **Fulfillment Status** (—Å—Ç–∞—Ç—É—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è)

#### **1. Order Status (–æ—Å–Ω–æ–≤–Ω–æ–π –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª)**

```mermaid
stateDiagram-v2
    [*] --> pending: —Å–æ–∑–¥–∞–Ω –∑–∞–∫–∞–∑
    pending --> confirmed: –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª
    pending --> cancelled: –∫–ª–∏–µ–Ω—Ç/–º–µ–Ω–µ–¥–∂–µ—Ä –æ—Ç–º–µ–Ω–∏–ª
    
    confirmed --> processing: –Ω–∞—á–∞—Ç–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞
    confirmed --> cancelled: –æ—Ç–º–µ–Ω—ë–Ω –¥–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏
    
    processing --> shipped: —Ç–æ–≤–∞—Ä –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω
    processing --> cancelled: –æ—Ç–º–µ–Ω—ë–Ω –≤–æ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
    
    shipped --> delivered: –¥–æ—Å—Ç–∞–≤–ª–µ–Ω
    shipped --> returned: –≤–æ–∑–≤—Ä–∞—Ç –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–Ω
    
    delivered --> completed: –∑–∞–≤–µ—Ä—à—ë–Ω —É—Å–ø–µ—à–Ω–æ
    delivered --> returned: –∫–ª–∏–µ–Ω—Ç –≤–µ—Ä–Ω—É–ª —Ç–æ–≤–∞—Ä
    
    returned --> refunded: –≤–æ–∑–≤—Ä–∞—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω
    refunded --> [*]
    completed --> [*]
    cancelled --> [*]
```

**–í–∞–ª–∏–¥–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã:**

| –ò–∑ —Å—Ç–∞—Ç—É—Å–∞   | –í —Å—Ç–∞—Ç—É—Å    | –£—Å–ª–æ–≤–∏–µ                      | –ö—Ç–æ –º–æ–∂–µ—Ç                     |
| ------------ | ----------- | ---------------------------- | ----------------------------- |
| `pending`    | `confirmed` | payment\_status = 'paid'     | –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ / –º–µ–Ω–µ–¥–∂–µ—Ä      |
| `pending`    | `cancelled` | –ª—é–±–æ–µ                        | –∫–ª–∏–µ–Ω—Ç, –º–µ–Ω–µ–¥–∂–µ—Ä, –∞–≤—Ç–æ–º–∞—Ç–∏–∫–∞  |
| `confirmed`  | `processing`| stock –¥–æ—Å—Ç—É–ø–µ–Ω               | –º–µ–Ω–µ–¥–∂–µ—Ä                      |
| `confirmed`  | `cancelled` | –¥–æ –Ω–∞—á–∞–ª–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏          | –º–µ–Ω–µ–¥–∂–µ—Ä                      |
| `processing` | `shipped`   | tracking\_number –∑–∞–ø–æ–ª–Ω–µ–Ω    | –º–µ–Ω–µ–¥–∂–µ—Ä                      |
| `processing` | `cancelled` | —Ç–æ–ª—å–∫–æ —Å —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ–º       | –º–µ–Ω–µ–¥–∂–µ—Ä (admin role)         |
| `shipped`    | `delivered` | –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–æ—Å—Ç–∞–≤–∫–∏       | –∫—É—Ä—å–µ—Ä / –∞–≤—Ç–æ–º–∞—Ç–∏–∫–∞           |
| `delivered`  | `completed` | 7 –¥–Ω–µ–π –±–µ–∑ –ø—Ä–µ—Ç–µ–Ω–∑–∏–π         | –∞–≤—Ç–æ–º–∞—Ç–∏–∫–∞                    |
| `delivered`  | `returned`  | –∫–ª–∏–µ–Ω—Ç –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–ª –≤–æ–∑–≤—Ä–∞—Ç   | –∫–ª–∏–µ–Ω—Ç ‚Üí –º–µ–Ω–µ–¥–∂–µ—Ä –æ–¥–æ–±—Ä—è–µ—Ç    |
| `returned`   | `refunded`  | –≤–æ–∑–≤—Ä–∞—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω            | –º–µ–Ω–µ–¥–∂–µ—Ä                      |

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏:**

```typescript
const ORDER_STATUS_TRANSITIONS = {
  pending: ['confirmed', 'cancelled'],
  confirmed: ['processing', 'cancelled'],
  processing: ['shipped', 'cancelled'],
  shipped: ['delivered', 'returned'],
  delivered: ['completed', 'returned'],
  returned: ['refunded'],
  completed: [],
  cancelled: [],
  refunded: []
};

function canTransition(from: string, to: string): boolean {
  return ORDER_STATUS_TRANSITIONS[from]?.includes(to) ?? false;
}

// –í —Å–µ—Ä–≤–∏—Å–µ:
async updateOrderStatus(orderId, newStatus, userId) {
  const order = await findOrder(orderId);
  if (!canTransition(order.status, newStatus)) {
    throw new BadRequestException(`Cannot transition from ${order.status} to ${newStatus}`);
  }
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
  await checkPermission(userId, 'orders.update_status', { currentStatus: order.status, newStatus });
  
  // –ê—Ç–æ–º–∞—Ä–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ + —Å–æ–±—ã—Ç–∏–µ
  await db.transaction(async tx => {
    await tx.orders.update({ status: newStatus, updated_at: NOW() });
    await tx.orderEvents.create({
      order_id: orderId,
      type: 'order.status_changed',
      data: { from: order.status, to: newStatus },
      user_id: userId
    });
  });
  
  await eventBus.emit('order.status_changed', { orderId, from: order.status, to: newStatus });
}
```

#### **2. Payment Status**

```
pending ‚Üí processing ‚Üí paid ‚Üí refunded
              ‚Üì
           failed
```

| –°—Ç–∞—Ç—É—Å      | –û–ø–∏—Å–∞–Ω–∏–µ                            |
| ----------- | ----------------------------------- |
| `pending`   | –æ–∂–∏–¥–∞–Ω–∏–µ –æ–ø–ª–∞—Ç—ã                     |
| `processing`| –æ–ø–ª–∞—Ç–∞ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ (redirect –∫ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—É) |
| `paid`      | —É—Å–ø–µ—à–Ω–æ –æ–ø–ª–∞—á–µ–Ω                     |
| `failed`    | –ø–ª–∞—Ç—ë–∂ –Ω–µ –ø—Ä–æ—à—ë–ª                    |
| `refunded`  | –≤–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω            |

**–ê–≤—Ç–æ–º–∞—Ç–∏–∫–∞:**
- –ï—Å–ª–∏ `pending` > 15 –º–∏–Ω—É—Ç ‚Üí —Ä–µ–∑–µ—Ä–≤ stock –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è
- –ï—Å–ª–∏ `paid` ‚Üí —Ç—Ä–∏–≥–≥–µ—Ä –ø–µ—Ä–µ—Ö–æ–¥–∞ order status –≤ `confirmed`

#### **3. Fulfillment Status**

```
unfulfilled ‚Üí partially_fulfilled ‚Üí fulfilled
```

| –°—Ç–∞—Ç—É—Å               | –û–ø–∏—Å–∞–Ω–∏–µ                             |
| -------------------- | ------------------------------------ |
| `unfulfilled`        | –Ω–∏ –æ–¥–∏–Ω —Ç–æ–≤–∞—Ä –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω           |
| `partially_fulfilled`| —á–∞—Å—Ç—å —Ç–æ–≤–∞—Ä–æ–≤ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ (split orders) |
| `fulfilled`          | –≤—Å–µ —Ç–æ–≤–∞—Ä—ã –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã                |

**Permissions (RBAC):**

```json
{
  "roles": {
    "customer": ["orders.view_own", "orders.cancel_pending"],
    "manager": ["orders.view_all", "orders.update_status", "orders.add_notes"],
    "admin": ["orders.*"]
  }
}
```

---

## 7) –ü–æ–∏—Å–∫ –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏—è

- –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –≤ —Ñ–æ–Ω–µ: —Å–æ–±—ã—Ç–∏—è `ProductCreated/Updated/Deleted` –∫–ª–∞–¥—É—Ç –∑–∞–¥–∞—á–∏ –≤ –æ—á–µ—Ä–µ–¥—å.
- –°–∏–Ω–æ–Ω–∏–º—ã –∏ –æ–ø–µ—á–∞—Ç–∫–∏ –≤–∫–ª—é—á–µ–Ω—ã; —Ñ–∞—Å–µ—Ç—ã: —Ü–µ–Ω–∞/–±—Ä–µ–Ω–¥/–∫–ª—é—á–µ–≤—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã.
- 404/410 –¥–ª—è —É–¥–∞–ª—ë–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤; 301 —Ä–µ–¥–∏—Ä–µ–∫—Ç—ã –ø—Ä–∏ —Å–º–µ–Ω–µ —Å–ª–∞–≥–∞.

### 7.1 –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –¥–æ–º–µ–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π

**–ó–∞—á–µ–º:** —Å–æ–±—ã—Ç–∏—è ‚Äî –æ—Å–Ω–æ–≤–∞ event-driven –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã. –≠—Ç–æ—Ç —Å–ø–∏—Å–æ–∫ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∫—ç—à-–∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏, –æ—á–µ—Ä–µ–¥–µ–π –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π.

**–§–æ—Ä–º–∞—Ç —Å–æ–±—ã—Ç–∏—è:**

```typescript
interface DomainEvent<T = any> {
  id: string;              // UUID —Å–æ–±—ã—Ç–∏—è
  type: string;            // 'product.created'
  aggregateId: string;     // ID —Å—É—â–Ω–æ—Å—Ç–∏ (productId, orderId)
  aggregateType: string;   // 'product', 'order'
  data: T;                 // payload —Å–æ–±—ã—Ç–∏—è
  metadata: {
    userId?: string;
    ip?: string;
    userAgent?: string;
    timestamp: Date;
    correlationId: string; // –¥–ª—è trace distributed requests
  };
}
```

#### **–ö–∞—Ç–∞–ª–æ–≥ (Products)**

| –°–æ–±—ã—Ç–∏–µ                     | –¢—Ä–∏–≥–≥–µ—Ä                         | Payload (data)                           | –î–µ–π—Å—Ç–≤–∏—è                                      |
| --------------------------- | ------------------------------- | ---------------------------------------- | --------------------------------------------- |
| `product.created`           | —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞                 | `{ productId, slug, published }`         | reindex Meili, purge /products                |
| `product.updated`           | –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞                | `{ productId, changes }`                 | reindex, purge –∫–∞—Ä—Ç–æ—á–∫–∏                       |
| `product.deleted`           | soft-delete —Ç–æ–≤–∞—Ä–∞              | `{ productId, slug }`                    | delete from Meili, purge, 410 redirect        |
| `product.published`         | –ø—É–±–ª–∏–∫–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–∞               | `{ productId }`                          | reindex, purge categories/home                |
| `product.unpublished`       | —Å–Ω—è—Ç–∏–µ —Å –ø—É–±–ª–∏–∫–∞—Ü–∏–∏             | `{ productId }`                          | delete from Meili, purge                      |
| `variant.price_changed`     | –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–µ–Ω—ã –≤–∞—Ä–∏–∞–Ω—Ç–∞         | `{ variantId, oldPrice, newPrice, sku }` | revalidateTag('price:{sku}'), reindex         |
| `variant.stock_changed`     | –∏–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Å—Ç–∞—Ç–∫–∞               | `{ variantId, oldStock, newStock, sku }` | revalidateTag('stock:{sku}'), —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ     |
| `variant.created`           | –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç–∞             | `{ variantId, productId, sku }`          | reindex product                               |
| `variant.deleted`           | —É–¥–∞–ª–µ–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç–∞               | `{ variantId, sku }`                     | reindex, purge                                |
| `translation.created`       | –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–≤–æ–¥–∞             | `{ entityType, entityId, locale }`       | reindex –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞                    |
| `translation.updated`       | –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–≤–æ–¥–∞             | `{ entityType, entityId, locale }`       | reindex, purge –ø–æ locale                      |
| `category.created`          | —Å–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏              | `{ categoryId, parentId }`               | purge /categories, rebuild tree               |
| `category.updated`          | –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏             | `{ categoryId, changes }`                | purge –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –≤—Å–µ—Ö —Ä–æ–¥–∏—Ç–µ–ª–µ–π              |
| `category.deleted`          | —É–¥–∞–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏              | `{ categoryId }`                         | purge, reindex products                       |
| `category.tree_changed`     | –∏–∑–º–µ–Ω–µ–Ω–∏–µ –¥–µ—Ä–µ–≤–∞ (parent)       | `{ categoryId, oldParent, newParent }`   | rebuild full_path, purge all categories       |

#### **–ö–æ—Ä–∑–∏–Ω–∞ (Cart)**

| –°–æ–±—ã—Ç–∏–µ              | –¢—Ä–∏–≥–≥–µ—Ä                       | Payload                             | –î–µ–π—Å—Ç–≤–∏—è                                |
| -------------------- | ----------------------------- | ----------------------------------- | --------------------------------------- |
| `cart.created`       | —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ—Ä–∑–∏–Ω—ã              | `{ cartId, userId?, guestToken? }`  | ‚Äî                                       |
| `cart.item_added`    | –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –≤ –∫–æ—Ä–∑–∏–Ω—É   | `{ cartId, variantId, quantity }`   | —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)               |
| `cart.item_updated`  | –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞          | `{ cartId, itemId, newQuantity }`   | ‚Äî                                       |
| `cart.item_removed`  | —É–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞               | `{ cartId, itemId }`                | ‚Äî                                       |
| `cart.coupon_applied`| –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫—É–ø–æ–Ω–∞             | `{ cartId, couponCode, discount }`  | –ø–µ—Ä–µ—Å—á—ë—Ç totals                         |
| `cart.abandoned`     | –∫–æ—Ä–∑–∏–Ω–∞ –±—Ä–æ—à–µ–Ω–∞ (2—á+ –Ω–µ –∞–∫—Ç–∏–≤)| `{ cartId, userId?, email?, items }`| job ‚Üí abandoned cart email              |
| `cart.converted`     | –∫–æ—Ä–∑–∏–Ω–∞ –ø—Ä–µ–≤—Ä–∞—Ç–∏–ª–∞—Å—å –≤ –∑–∞–∫–∞–∑  | `{ cartId, orderId }`               | ‚Äî                                       |

#### **–ó–∞–∫–∞–∑—ã (Orders)**

| –°–æ–±—ã—Ç–∏–µ                  | –¢—Ä–∏–≥–≥–µ—Ä                          | Payload                                       | –î–µ–π—Å—Ç–≤–∏—è                                     |
| ------------------------ | -------------------------------- | --------------------------------------------- | -------------------------------------------- |
| `order.created`          | —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞                  | `{ orderId, number, userId?, total }`         | email confirmation, —Ä–µ–∑–µ—Ä–≤ stock, analytics  |
| `order.status_changed`   | –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞                | `{ orderId, from, to }`                       | email/SMS —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ, –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ stock    |
| `order.paid`             | –æ–ø–ª–∞—Ç–∞ —É—Å–ø–µ—à–Ω–∞                   | `{ orderId, paymentId, amount }`              | —Ç—Ä–∏–≥–≥–µ—Ä confirmed, email receipt, analytics  |
| `order.payment_failed`   | –ø–ª–∞—Ç—ë–∂ –Ω–µ –ø—Ä–æ—à—ë–ª                 | `{ orderId, paymentId, error }`               | email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ, –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ stock        |
| `order.shipped`          | –∑–∞–∫–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω                  | `{ orderId, trackingNumber, carrier }`        | email + SMS —Å —Ç—Ä–µ–∫–∏–Ω–≥–æ–º                      |
| `order.delivered`        | –∑–∞–∫–∞–∑ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω                  | `{ orderId }`                                 | email –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ, –∑–∞–ø—É—Å–∫ —Ç–∞–π–º–µ—Ä–∞ review   |
| `order.cancelled`        | –∑–∞–∫–∞–∑ –æ—Ç–º–µ–Ω—ë–Ω                    | `{ orderId, reason, userId }`                 | –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ stock, refund (–µ—Å–ª–∏ –æ–ø–ª–∞—á–µ–Ω)    |
| `order.refunded`         | –≤–æ–∑–≤—Ä–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω                 | `{ orderId, amount }`                         | email –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ                          |
| `order.note_added`       | –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–æ–±–∞–≤–ª–µ–Ω             | `{ orderId, note, userId }`                   | ‚Äî                                            |

#### **–ü–ª–∞—Ç–µ–∂–∏ (Payments)**

| –°–æ–±—ã—Ç–∏–µ                    | –¢—Ä–∏–≥–≥–µ—Ä                    | Payload                                  | –î–µ–π—Å—Ç–≤–∏—è                              |
| -------------------------- | -------------------------- | ---------------------------------------- | ------------------------------------- |
| `payment.initiated`        | –Ω–∞—á–∞–ª–æ –ø–ª–∞—Ç–µ–∂–∞             | `{ paymentId, orderId, amount }`         | ‚Äî                                     |
| `payment.completed`        | –ø–ª–∞—Ç—ë–∂ —É—Å–ø–µ—à–µ–Ω             | `{ paymentId, orderId, txnId }`          | —Ç—Ä–∏–≥–≥–µ—Ä order.paid                    |
| `payment.failed`           | –ø–ª–∞—Ç—ë–∂ –ø—Ä–æ–≤–∞–ª–µ–Ω            | `{ paymentId, orderId, error }`          | retry logic, —Ç—Ä–∏–≥–≥–µ—Ä order.failed     |
| `payment.refund_initiated` | –≤–æ–∑–≤—Ä–∞—Ç –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞–Ω        | `{ paymentId, amount }`                  | ‚Äî                                     |
| `payment.refunded`         | –≤–æ–∑–≤—Ä–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω           | `{ paymentId, amount, txnId }`           | —Ç—Ä–∏–≥–≥–µ—Ä order.refunded                |
| `payment.webhook_received` | –≤–µ–±—Ö—É–∫ –æ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞       | `{ provider, txnId, status, rawData }`   | –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞               |

#### **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (Users)**

| –°–æ–±—ã—Ç–∏–µ                 | –¢—Ä–∏–≥–≥–µ—Ä                       | Payload                            | –î–µ–π—Å—Ç–≤–∏—è                       |
| ----------------------- | ----------------------------- | ---------------------------------- | ------------------------------ |
| `user.registered`       | —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è                   | `{ userId, email }`                | welcome email, analytics       |
| `user.email_verified`   | –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ email           | `{ userId }`                       | ‚Äî                              |
| `user.password_changed` | —Å–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è                  | `{ userId }`                       | security email                 |
| `user.logged_in`        | –≤—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É                | `{ userId, ip, userAgent }`        | security log                   |
| `user.blocked`          | –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è       | `{ userId, reason }`               | –æ—Ç–∑—ã–≤ —Ç–æ–∫–µ–Ω–æ–≤                  |

#### **–ö—É–ø–æ–Ω—ã (Coupons)**

| –°–æ–±—ã—Ç–∏–µ             | –¢—Ä–∏–≥–≥–µ—Ä                   | Payload                       | –î–µ–π—Å—Ç–≤–∏—è                  |
| ------------------- | ------------------------- | ----------------------------- | ------------------------- |
| `coupon.created`    | —Å–æ–∑–¥–∞–Ω–∏–µ –∫—É–ø–æ–Ω–∞           | `{ couponId, code }`          | ‚Äî                         |
| `coupon.used`       | –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫—É–ø–æ–Ω–∞      | `{ couponId, userId, orderId }`| increment usage_count     |
| `coupon.exhausted`  | –ª–∏–º–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π       | `{ couponId }`                | disable coupon            |
| `coupon.expired`    | –∏—Å—Ç—ë–∫ —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è       | `{ couponId }`                | ‚Äî                         |

#### **–°–∏—Å—Ç–µ–º–∞ (System)**

| –°–æ–±—ã—Ç–∏–µ                      | –¢—Ä–∏–≥–≥–µ—Ä                         | Payload                        | –î–µ–π—Å—Ç–≤–∏—è                     |
| ---------------------------- | ------------------------------- | ------------------------------ | ---------------------------- |
| `system.cache_invalidated`   | —Ä—É—á–Ω–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∞         | `{ tags[], keys[] }`           | purge CDN/Redis              |
| `system.index_rebuilt`       | –ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è           | `{ index, recordsCount }`      | ‚Äî                            |
| `system.backup_completed`    | –±—ç–∫–∞–ø –∑–∞–≤–µ—Ä—à—ë–Ω                  | `{ backupId, size, duration }` | –∞–ª–µ—Ä—Ç success                |
| `system.health_check_failed` | health check –Ω–µ –ø—Ä–æ—à—ë–ª          | `{ service, error }`           | –∞–ª–µ—Ä—Ç Telegram               |

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è event bus (NestJS):**

```typescript
// packages/domain/src/events/index.ts
export enum DomainEventType {
  PRODUCT_CREATED = 'product.created',
  PRODUCT_UPDATED = 'product.updated',
  ORDER_CREATED = 'order.created',
  ORDER_PAID = 'order.paid',
  // ... –≤—Å–µ —Å–æ–±—ã—Ç–∏—è –≤—ã—à–µ
}

// apps/api/src/events/event-bus.service.ts
@Injectable()
export class EventBusService {
  constructor(
    private eventEmitter: EventEmitter2,
    private queue: Queue, // BullMQ
  ) {}

  async emit(type: DomainEventType, data: any) {
    const event: DomainEvent = {
      id: uuid(),
      type,
      aggregateId: data.id || data.orderId || data.productId,
      aggregateType: type.split('.')[0],
      data,
      metadata: {
        timestamp: new Date(),
        correlationId: AsyncLocalStorage.getStore()?.correlationId,
      }
    };

    // –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —Å–ª—É—à–∞—Ç–µ–ª–∏ (–∫—ç—à-–∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è)
    this.eventEmitter.emit(type, event);

    // –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ (email, –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è)
    await this.queue.add('process-event', event, {
      attempts: 3,
      backoff: { type: 'exponential', delay: 2000 }
    });
  }
}
```

---

## 8) –§—Ä–æ–Ω—Ç–µ–Ω–¥: –≤–∏—Ç—Ä–∏–Ω–∞

- SSR/ISR + CDN, –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π CSS –∏–Ω–ª–∞–π–Ω, code‚Äësplitting, lazy –¥–ª—è –Ω–µ‚Äëabove‚Äëthe‚Äëfold.
- –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å: WCAG 2.2 AA, —Ñ–æ–∫—É—Å—ã, aria, –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞, skip‚Äëlinks.
- I18n: ICU‚Äëplural, –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–æ–≤ –¥–∞—Ç/–≤–∞–ª—é—Ç, –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ URL/hreflang.
- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: WebP/AVIF, `srcset/sizes`, –ª–∏–º–∏—Ç \~300 KB –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É, —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –Ω–∞ CDN, preconnect/preload –∫—Ä–∏—Ç–∏–∫–∏.
- –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è UI: loading/skeleton/empty/error.

---

## 9) –ê–¥–º–∏–Ω‚Äë–ø–∞–Ω–µ–ª—å (v1)

- –†–æ–ª–∏: –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä, –º–µ–Ω–µ–¥–∂–µ—Ä –∑–∞–∫–∞–∑–æ–≤, –∫–æ–Ω—Ç–µ–Ω—Ç‚Äë–º–µ–Ω–µ–¥–∂–µ—Ä, –º–∞—Ä–∫–µ—Ç–æ–ª–æ–≥.
- –ú–∞—Å—Å–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏: –∏–º–ø–æ—Ä—Ç CSV/XLSX (–≤–∞–ª–∏–¥–∞—Ü–∏—è + –æ—Ç—á—ë—Ç –æ—à–∏–±–æ–∫), –º–∞—Å—Å–æ–≤—ã–µ –ø—Ä–∞–≤–∫–∏ —Ü–µ–Ω/–æ—Å—Ç–∞—Ç–∫–æ–≤.
- –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏ –∞—É–¥–∏—Ç: –∫—Ç–æ/—á—Ç–æ/–∫–æ–≥–¥–∞.
- –ü—Ä–∞–≤–∞ –Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ (create/edit/delete/publish) –ø–æ —Ä–æ–ª—è–º.
- –®–∞–±–ª–æ–Ω—ã e‚Äëmail/SMS, –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä, –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è.

---

## 10) –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

**–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è/–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**

- –•–µ—à –ø–∞—Ä–æ–ª–µ–π: Argon2id (memory ‚â• 64MB, iterations/parallelism –ø–æ –ø—Ä–æ—Ñ–∏–ª—é –º–∞—à–∏–Ω—ã).
- –°–µ—Å—Å–∏–∏: HttpOnly, SameSite=Lax; refresh‚Äë—Ç–æ–∫–µ–Ω—ã ‚â§ 30 –¥–Ω–µ–π, —Ä–æ—Ç–∞—Ü–∏—è/–æ—Ç–∑—ã–≤.
- MFA –¥–ª—è –∞–¥–º–∏–Ω–æ–≤.
- RBAC deny‚Äëby‚Äëdefault; –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ, –Ω–µ —Ç–æ–ª—å–∫–æ –≤ UI.

**–í–≤–æ–¥/–≤–∞–ª–∏–¥–∞—Ü–∏—è**

- –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è DTO –Ω–∞ –±—ç–∫–µ; –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è/escape; —Å—Ç—Ä–æ–≥–∏–µ —Ç–∏–ø—ã.
- –ó–∞–ø—Ä–µ—Ç –ø—Ä—è–º—ã—Ö SQL ‚Äî —Ç–æ–ª—å–∫–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã ORM.

**–ó–∞—â–∏—Ç–∞ –æ—Ç –∞—Ç–∞–∫**

- CSRF –∑–∞—â–∏—Ç–∞ –Ω–∞ –∏–∑–º–µ–Ω—è—é—â–∏—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö; –∞–Ω—Ç–∏–±–æ—Ç (hCaptcha/reCAPTCHA) –Ω–∞ –ø—É–±–ª–∏—á–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ö.
- Rate‚Äëlimit per IP/user; circuit breaker –∏ —Ç–∞–π–º‚Äë–∞—É—Ç—ã –Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏.
- –ó–∞–≥–æ–ª–æ–≤–∫–∏: CSP (script‚Äësrc 'self' 'nonce‚Äë{n}'), HSTS, X‚ÄëContent‚ÄëType‚ÄëOptions, Referrer‚ÄëPolicy, Permissions‚ÄëPolicy, X‚ÄëFrame‚ÄëOptions.

**–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤**

- –ü—Ä–æ–≤–µ—Ä–∫–∞ MIME/—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞, –∞–Ω—Ç–∏–≤–∏—Ä—É—Å‚Äë—Å–∫–∞–Ω, –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –ø—Ä–µ—Ñ–∏–∫—Å—ã –≤ S3; –ø–æ–¥–ø–∏—Å–∏ URL —Å TTL.

**–°–µ–∫—Ä–µ—Ç—ã/–∫–æ–Ω—Ñ–∏–≥–∏**

- –ù–∏–∫–∞–∫–∏—Ö –∫–ª—é—á–µ–π –≤ Git. –°–µ–∫—Ä–µ—Ç‚Äë–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç (ENV, Vault/KMS). –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ dev/stage/prod.

**–õ–æ–≥–∏/PII**

- –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ JSON‚Äë–ª–æ–≥–∏ —Å correlation‚Äëid. –ú–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ PII, –∑–∞–ø—Ä–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å PAN.

---

## 11) –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –∫—ç—à

- CDN –ø–µ—Ä–µ–¥ Nginx, HTML‚Äë–∫—ç—à –∫–∞—Ç–µ–≥–æ—Ä–∏–π/—Ç–æ–≤–∞—Ä–æ–≤/–±—Ä–µ–Ω–¥–æ–≤ (ISR + `stale‚Äëwhile‚Äërevalidate`).
- Redis‚Äë–∫—ç—à –¥–ª—è —á–∞—Å—Ç–æ —á–∏—Ç–∞–µ–º—ã—Ö API (–ø—Ä–∞–π—Å‚Äë–±–ª–æ–∫–∏, —Ö–∏—Ç—ã) —Å TTL –∏ —Ç–æ—á–µ—á–Ω–æ–π –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –ø–æ —Å–æ–±—ã—Ç–∏—è–º (–∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–µ–Ω—ã/–æ—Å—Ç–∞—Ç–∫–∞/–ø—É–±–ª–∏–∫–∞—Ü–∏–∏).
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è SQL: –∏–Ω–¥–µ–∫—Å—ã, –∏–∑–±–µ–≥–∞—Ç—å N+1; `SELECT ‚Ä¶ FOR UPDATE` –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö.
- –ë—é–¥–∂–µ—Ç—ã: –¥–æ–º–∞—à–Ω—è—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π CSS/JS ‚â§ 150 KB; —à—Ä–∏—Ñ—Ç—ã ‚Äî `display: swap`.

### 11.1 –°—Ç—Ä–∞—Ç–µ–≥–∏—è –∫—ç—à‚Äë–∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ (–∫–æ–Ω–∫—Ä–µ—Ç–∏–∫–∞)

**–¢–∏–ø—ã –∫—ç—à–µ–π:**

1. **Edge/CDN** HTML –∏ media (Cloudflare).
2. **Next.js** Route/Data Cache (ISR, `revalidateTag`).
3. **Redis** –æ–±—ä–µ–∫—Ç–Ω—ã–π –∫—ç—à API/–∞–≥–≥—Ä–µ–≥–∞—Ç–æ–≤.
4. **–ë—Ä–∞—É–∑–µ—Ä–Ω—ã–π** –∫—ç—à —Å `ETag/Last-Modified`.

**–¢–µ–≥–∏ –∏ –≤–µ—Ä—Å–∏–∏:**

- –í –ë–î —É —Å—É—â–Ω–æ—Å—Ç–µ–π `version`/`updated_at`. –ö–ª—é—á Redis: `product:{id}:v{version}`. –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è = –∞—Ç–æ–º–∞—Ä–Ω—ã–π –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç –≤–µ—Ä—Å–∏–∏ –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏—è.
- –í Next.js –∏—Å–ø–æ–ª—å–∑—É–µ–º **cache tags**: `product:{id}`, `category:{id}`, `collection:{id}`, `price:{sku}`, `stock:{sku}`, `menu`, `home`, `sitemap`.
- HTML‚Äë–æ—Ç–≤–µ—Ç—ã –ø–æ–º–µ—á–∞—é—Ç—Å—è **Surrogate‚ÄëKey/Cache‚ÄëTag** –∑–∞–≥–æ–ª–æ–≤–∫–æ–º (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ) —Å —Ç–µ–º–∏ –∂–µ —Ç–µ–≥–∞–º–∏.

**–ú–µ—Ö–∞–Ω–∏–∫–∞ —Å–æ–±—ã—Ç–∏–π:** –ö–∞–∂–¥–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –¥–æ–º–µ–Ω–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ ‚Üí –æ—á–µ—Ä–µ–¥—å ‚Üí –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏:

| –°–æ–±—ã—Ç–∏–µ                        | –î–µ–π—Å—Ç–≤–∏—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏                                                                                                           |
| ------------------------------ | ------------------------------------------------------------------------------------------------------------------------------ |
| ProductCreated/Updated/Deleted | `revalidateTag('product:{id}')`, purge CDN –ø–æ —Ç–µ–≥—É `product:{id}`, –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç –≤–µ—Ä—Å–∏–∏ Redis, reindex Meili                       |
| TranslationCreated/Updated     | `revalidateTag('product:{id}')`/`category:{id}` –¥–ª—è –Ω—É–∂–Ω–æ–π –ª–æ–∫–∞–ª–∏; purge CDN –ø–æ –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–º URL, reindex –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞ |
| PriceChanged                   | `revalidateTag('price:{sku}')`, –æ–±–Ω–æ–≤–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É –≤ Redis, –º—è–≥–∫–∏–π purge –ø—Ä–æ–¥—É–∫—Ç–æ–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã                                   |
| StockChanged                   | `revalidateTag('stock:{sku}')`, –æ–±–Ω–æ–≤–∏—Ç—å –±–ª–æ–∫ –Ω–∞–ª–∏—á–∏—è, –±–µ–∑ –ø–æ–ª–Ω–æ–≥–æ purge –∫–∞—Ç–∞–ª–æ–≥–∞                                              |
| CategoryChanged/TreeChanged    | `revalidateTag('category:{id}')`, purge –∫–∞—Ç–µ–≥–æ—Ä–∏–π/—Ö–ª–µ–±–Ω—ã—Ö –∫—Ä–æ—à–µ–∫, –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å `full_path`, reindex –¥–æ—á–µ—Ä–Ω–∏—Ö                    |
| Publish/Unpublish              | purge —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö —Å—Ç—Ä–∞–Ω–∏—Ü/—Å–ø–∏—Å–∫–æ–≤, reindex                                                                                 |

**CDN purge:**

- –ï—Å–ª–∏ –µ—Å—Ç—å Cache‚ÄëTags ‚Äî —á–∏—Å—Ç–∏–º –ø–æ —Ç–µ–≥–∞–º –±–∞—Ç—á–∞–º–∏.
- –ù–µ—Ç —Ç–µ–≥–æ–≤ ‚Äî —á–∏—Å—Ç–∏–º –ø–æ —Å–ø–∏—Å–∫—É URL (–ø—Ä–æ–¥—É–∫—Ç, –µ–≥–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –±—Ä–µ–Ω–¥, –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ 1‚Äì3).
- –í—Å–µ purge –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã –∏ –±–∞—Ç—á–∞—Ç—Å—è (debounce 2‚Äì5 —Å–µ–∫) –¥–ª—è –º–∞—Å—Å–æ–≤—ã—Ö –ø—Ä–∞–≤–æ–∫.

**Next.js ISR:**

- –°—Ç—Ä–∞–Ω–∏—Ü—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–π/—Ç–æ–≤–∞—Ä–æ–≤ —Å—Ç—Ä–æ—è—Ç—Å—è —Å `revalidate` –∏ **—Ç–µ–≥–∞–º–∏**. –ù–∞ —Å–æ–±—ã—Ç–∏–∏ –≤—ã–∑—ã–≤–∞–µ–º —Å–µ—Ä–≤–µ—Ä–Ω—ã–π `revalidateTag(tag)`. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç stale, –∞ —Ñ–æ–Ω –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–≤–µ–∂—É—é –≤–µ—Ä—Å–∏—é.

**Redis:**

- –ö–ª—é—á–∏ –≤–∫–ª—é—á–∞—é—Ç –≤–µ—Ä—Å–∏—é. –ù–∞ —Å–æ–±—ã—Ç–∏–∏ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏–º –≤–µ—Ä—Å–∏—é –∏ –ø—É–±–ª–∏–∫—É–µ–º `invalidate:{entity}:{id}` –≤ Pub/Sub, —á—Ç–æ–±—ã –≤—Å–µ –∏–Ω—Å—Ç–∞–Ω—Å—ã –≤—ã–∫–∏–Ω—É–ª–∏ —Å—Ç–∞—Ä–æ–µ.

**Batch‚Äë–∏–º–ø–æ—Ä—Ç:**

- –í–∫–ª—é—á–∞–µ–º `bulk-mode`: –æ—Ç–∫–ª—é—á–∞–µ–º —Ç–æ—á–µ—á–Ω—ã–π purge, —Å–æ–±–∏—Ä–∞–µ–º ID –∏ –¥–µ–ª–∞–µ–º **coarse purge –ø–æ —Ç–µ–≥–∞–º** (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–∞—Ç–µ–≥–æ—Ä–∏—è/–±—Ä–µ–Ω–¥) + –ø–∞–∫–µ—Ç–Ω—É—é reindex. –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º QPS –∫ CDN API.

**TTL –∏ –ø–æ–ª–∏—Ç–∏–∫–∞:**

- HTML –∫–∞—Ç–µ–≥–æ—Ä–∏–π/—Ç–æ–≤–∞—Ä–æ–≤: `max-age=0, s-maxage=600, stale-while-revalidate=86400`.
- –î–∞–Ω–Ω—ã–µ —Ü–µ–Ω—ã/–æ—Å—Ç–∞—Ç–∫–æ–≤: Redis TTL 30‚Äì60 —Å–µ–∫ –∏ —Å–æ–±—ã—Ç–∏–µ‚Äë–∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏. –ö–æ—Ä–∑–∏–Ω–∞/checkout –Ω–µ –∫—ç—à–∏—Ä—É—é—Ç—Å—è.

**–ó–∞—â–∏—Ç–∞ –æ—Ç —à—Ç–æ—Ä–º–æ–≤:**

- Debounce/—Ç—Ä–æ—Ç—Ç–ª–∏–Ω–≥ purge, –¥–∂–∏—Ç—Ç–µ—Ä, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ –ª–æ–∫–∏ –Ω–∞ reindex. –ú–µ—Ç—Ä–∏–∫–∏: hit‚Äërate, –≤—Ä–µ–º—è `revalidate`, —á–∞—Å—Ç–æ—Ç–∞ purge, –æ—à–∏–±–∫–∏ CDN API.

**–ê–¥–º–∏–Ω‚ÄëUX:**

- –ö–Ω–æ–ø–∫–∏: ¬´–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞¬ª, ¬´–û—á–∏—Å—Ç–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é¬ª, ¬´–ü–æ–ª–Ω—ã–π purge –≤–∏—Ç—Ä–∏–Ω—ã¬ª —Å –∑–∞—â–∏—Ç–æ–π –∏ –∂—É—Ä–Ω–∞–ª–æ–º.

---

## 12) –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ –¥–µ–ø–ª–æ–π

- **VPS + Docker Compose**: web, api, redis, meilisearch, nginx –æ—Ç–¥–µ–ª—å–Ω—ã–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏; Postgres —É–ø—Ä–∞–≤–ª—è–µ–º—ã–π –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–π VPS.
- **CDN/WAF**: Cloudflare; –∫—ç—à, DDoS, TLS 1.2+.
- **CI/CD**: GitHub Actions ‚Üí –ª–∏–Ω—Ç/—Ç–∏–ø—ã/—Ç–µ—Å—Ç—ã ‚Üí —Å–±–æ—Ä–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ ‚Üí –¥–µ–ø–ª–æ–π –ø–æ SSH, blue‚Äëgreen (web\_v1/web\_v2). –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –Ω–∞ —Ä–µ–ª–∏–∑–µ.
- **–û–±—Å–µ—Ä–≤–∞–±–∏–ª–∏—Ç–∏**: Loki/Prometheus/Grafana, Uptime‚Äë–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥, –∞–ª–µ—Ä—Ç—ã –≤ Telegram (–æ—à–∏–±–∫–∏ 5xx, latency p95, –ª–∞–≥ –æ—á–µ—Ä–µ–¥–µ–π).
- **–ë—ç–∫–∞–ø—ã/DR**: –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç—ã, –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ –ø–æ–ª–Ω—ã–µ; offsite‚Äë–∫–æ–ø–∏—è; –µ–∂–µ–∫–≤–∞—Ä—Ç–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.

–ù–∞—á–∞–ª—å–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã: web+api 8 vCPU/16 GB, Meili 4 vCPU/8 GB, Redis 2 vCPU/4 GB, Postgres 2‚Äì4 vCPU/8‚Äì16 GB.

---

## 13) –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∫–∞—á–µ—Å—Ç–≤–æ

- **Unit** —è–¥—Ä–∞ –∏ —Å–µ—Ä–≤–∏—Å–æ–≤, **API‚Äë–∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã**; –ø–æ–∫—Ä—ã—Ç–∏–µ —è–¥—Ä–∞ ‚â• 70%.
- **E2E** (Playwright): –ø–æ–∏—Å–∫ ‚Üí –∫–æ—Ä–∑–∏–Ω–∞ ‚Üí checkout ‚Üí –æ–ø–ª–∞—Ç–∞ ‚Üí —Å–º–µ–Ω–∞ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞.
- **–ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ** (k6): 100‚Äì150 RPS —á—Ç–µ–Ω–∏–µ, 5‚Äì20 RPS –∑–∞–ø–∏—Å—å (–ø–∏–∫–∏ 10 –º–∏–Ω) –±–µ–∑ –Ω–∞—Ä—É—à–µ–Ω–∏—è SLO.
- **Lighthouse** –≤ CI: mobile ‚â• 85, desktop ‚â• 95; –∫–æ–Ω—Ç—Ä–æ–ª—å CWV.
- **Security**: SAST (ESLint/type‚Äëcheck), –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (Trivy/Snyk), —Å–µ–∫—Ä–µ—Ç–æ–≤ (gitleaks).

**Definition of Done (–∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏)**

- –¢–µ—Å—Ç—ã –µ—Å—Ç—å (unit/integration/e2e –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏).
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞ (README/ADR/API).
- –õ–æ–≥–∏/–º–µ—Ç—Ä–∏–∫–∏/–∞–ª–µ—Ä—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç –Ω–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª.
- –ù–µ—Ç —Ä–µ–≥—Ä–µ—Å—Å–∏–π –ø–µ—Ä—Ñ–æ—Ä–º–∞–Ω—Å–∞ (Lighthouse/Profiler).
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: —Ö–µ–¥–µ—Ä—ã, –ø—Ä–∞–≤–∞, –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã.

---

## 14) SEO –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

- Canonical, OG/Twitter, Schema.org: Product, BreadcrumbList, Organization.
- XML‚Äësitemap index, –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π robots –¥–ª—è stage/prod.
- GA4 + server‚Äëside events (view\_item, add\_to\_cart, begin\_checkout, purchase); –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è; —Å–æ–±–ª—é–¥–µ–Ω–∏–µ consent.

---

## 15) –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –≤–≤–æ–¥ –≤ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—é

- README: dev/stage/prod, —à–∞–±–ª–æ–Ω—ã `.env`, –∫–æ–º–∞–Ω–¥—ã.
- ER‚Äë–¥–∏–∞–≥—Ä–∞–º–º–∞, —Å–æ–±—ã—Ç–∏—è, –≤–µ–±—Ö—É–∫–∏, —Å—Ö–µ–º—ã —Å—Ç–∞—Ç—É—Å–æ–≤ –∑–∞–∫–∞–∑–∞.
- –ß–µ–∫‚Äë–ª–∏—Å—Ç –∑–∞–ø—É—Å–∫–∞ –Ω–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ (‚â§ 30 —à–∞–≥–æ–≤) –∏ –ø–ª–∞–Ω –æ—Ç–∫–∞—Ç–∞.

**–ü—Ä–µ–¥—Ä–µ–ª–∏–∑–Ω—ã–π —á–µ–∫‚Äë–ª–∏—Å—Ç**

1. –ú–∏–≥—Ä–∞—Ü–∏–∏/—Å–∏–¥—ã –ø—Ä–æ—Ö–æ–¥—è—Ç –Ω–∞ stage.
2. Lighthouse mobile/desktop –≤ –±—é–¥–∂–µ—Ç–µ; CWV –≤ –∑–µ–ª—ë–Ω–æ–π –∑–æ–Ω–µ.
3. k6 –Ω–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–π–¥–µ–Ω–∞.
4. –ü–ª–∞—Ç—ë–∂–Ω—ã–µ –≤–µ–±—Ö—É–∫–∏ ‚Äî –æ–∫, –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞.
5. –ë—ç–∫–∞–ø —Å–≤–µ–∂–∏–π, –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ.
6. –î–æ–º–µ–Ω—ã/SSL/CDN –≥–æ—Ç–æ–≤—ã, –∫—ç—à‚Äë–∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç.
7. –ü–æ—á—Ç–∞/SMS –¥–æ—Å—Ç–∞–≤–ª—è—é—Ç—Å—è; SPF/DKIM/DMARC –æ–∫.
8. –ü–æ–ª–∏—Ç–∏–∫–∏/robots/sitemap –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã.
9. –ê–ª–µ—Ä—Ç—ã –≤–∫–ª—é—á–µ–Ω—ã.
10. –ï—Å—Ç—å –ø–ª–∞–Ω –æ—Ç–∫–∞—Ç–∞.

**–ü–æ—Å—Ç—Ä–µ–ª–∏–∑ (48 —á–∞—Å–æ–≤)**: –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ error‚Äërate/latency/–∫–æ–Ω–≤–µ—Ä—Å–∏–∏ checkout; –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –ø–æ–∏—Å–∫–∞ –∏ —Ñ–∏–¥–æ–≤; —Å–±–æ—Ä RUM CWV; –ø–æ—Å—Ç‚Äë–º–æ—Ä–µ–º.

---

## 16) –ü–æ—á–µ–º—É —ç—Ç–æ —Ä–µ—à–µ–Ω–∏–µ ¬´—Ä–∞–±–æ—á–µ–µ –≤ –∂–∏–∑–Ω–∏¬ª

- **–ë–µ–∑ –ª–∏—à–Ω–µ–π –º–∞–≥–∏–∏**: –æ–¥–∏–Ω –ø—Ä–æ–µ–∫—Ç, —á—ë—Ç–∫–æ —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —è–¥—Ä–æ, –ø–æ–Ω—è—Ç–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥–∏ –∏ –∞–¥–∞–ø—Ç–µ—Ä—ã.
- **–ë–µ–∑ ¬´–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ —à–∞–±–ª–æ–Ω–∞¬ª**: —ç—Ç–æ –Ω–µ CMS –∏ –Ω–µ runtime‚Äë–∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä; —Å–∫–æ—Ä–æ—Å—Ç—å –∑–∞–¥–∞—é—Ç –∫—ç—à/–∏–Ω–¥–µ–∫—Å—ã/CDN –∏ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞ –±–∞–Ω–¥–ª–∞.
- **–ì–∏–±–∫–æ—Å—Ç—å**: –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–∞—è –¥–æ–º–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å –∏ –∞–¥–∞–ø—Ç–µ—Ä—ã –ø–æ–∑–≤–æ–ª—è—é—Ç —É–≤–µ—Å—Ç–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –¥–∞–ª–µ–∫–æ –æ—Ç –±–∞–∑—ã –±–µ–∑ —Å–Ω–æ—Å–∞ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞.
- **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å**: —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã —Ç–µ—Å—Ç–æ–≤/–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏/–¥–µ–ø–ª–æ—è —É–º–µ–Ω—å—à–∞—é—Ç —à–∞–Ω—Å —Å–ª–æ–≤–∏—Ç—å ¬´–¥–æ–ª–≥¬ª –≤ –∫–∞–∂–¥–æ–π –∫–æ–ø–∏–∏.

> –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ä–∏–µ–Ω—Ç–∏—Ä: –ø–µ—Ä–≤—ã–π –º–∞–≥–∞–∑–∏–Ω –¥–µ–ª–∞–µ–º –ø–æ —ç—Ç–æ–º—É –¢–ó. –í—Å–µ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –ø—Ä–æ–µ–∫—Ç—ã —Å—Ç–∞—Ä—Ç—É—é—Ç –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –∏ –∑–∞–º–µ–Ω–æ–π —Ç–µ–º—ã/–∫–æ–Ω—Ñ–∏–≥–æ–≤, –∞ —è–¥—Ä–æ –∏ –Ω–æ—Ä–º—ã –æ—Å—Ç–∞—é—Ç—Å—è –µ–¥–∏–Ω—ã–º–∏, —á—Ç–æ–±—ã –Ω–µ –∑–∞–±—ã—Ç—å –Ω–∏—á–µ–≥–æ –≤–∞–∂–Ω–æ–≥–æ ‚Äî –æ—Å–æ–±–µ–Ω–Ω–æ –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

